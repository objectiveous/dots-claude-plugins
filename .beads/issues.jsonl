{"id":"dots-0se","title":"Add PreToolUse hook to require bead context","description":"Implement soft-block hook that prevents code changes (Edit/Write) outside bead context to enforce dots-swe workflow","design":"## Problem\nClaude tries to work directly in main session instead of creating beads and dispatching to worktrees. This bypasses the dots-swe workflow for tracked, isolated work.\n\n## Solution\nAdd PreToolUse hook on Edit/Write tools that soft-blocks when not in bead context (.swe-bead file missing).\n\n## Implementation\n\n### 1. Update hooks.json\nFile: dots-swe/hooks/hooks.json\n\nAdd PreToolUse hook:\n```json\n{\n  \"hooks\": {\n    \"SessionStart\": [...existing...],\n    \"PreToolUse\": [\n      {\n        \"matcher\": \"Edit|Write\",\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"bash ${CLAUDE_PLUGIN_ROOT}/scripts/require-bead-context.sh\"\n          }\n        ]\n      }\n    ]\n  }\n}\n```\n\n### 2. Create require-bead-context.sh\nFile: dots-swe/scripts/require-bead-context.sh\n\nLogic:\n1. Check if .swe-bead exists → allow (in worktree)\n2. Check if bypass flag exists ($HOME/.claude/swe-bead-bypass-$$) → allow\n3. Otherwise → soft block with instructions\n\nReturn JSON:\n- Allow: {\"continue\": true}\n- Block: {\"decision\": \"block\", \"reason\": \"...\", \"message\": \"...\"}\n\nMessage format:\n```\n⚠️ No bead context detected.\n\nTo track this work properly:\n  1. bd create --title=\"...\" --type=task\n  2. /dots-swe:dispatch \u003cbead-id\u003e\n\nOr type 'allow once' to proceed without tracking.\n```\n\n### 3. Bypass handling\nWhen user types \"allow once\", Claude should run:\n```bash\ntouch \"$HOME/.claude/swe-bead-bypass-$$\"\n```\n\nThis allows subsequent edits in the same session (process ID-scoped).\n\n## Related Files\n- dots-swe/hooks/hooks.json (modify)\n- dots-swe/scripts/require-bead-context.sh (create)","acceptance_criteria":"- dots-swe/hooks/hooks.json contains PreToolUse hook for Edit|Write\n- dots-swe/scripts/require-bead-context.sh exists and is executable\n- In main repo (no .swe-bead): Edit tool triggers soft-block message\n- In worktree (has .swe-bead): Edit tool proceeds without prompt\n- \"allow once\" bypass creates flag file and allows subsequent edits\n- New session requires new bypass (process-scoped)\n- Hook returns valid JSON in both allow and block cases","status":"closed","priority":2,"issue_type":"task","owner":"robert@sidequest.vip","created_at":"2026-01-22T20:45:57.092376-10:00","created_by":"kenpo","updated_at":"2026-01-22T20:58:57.998944-10:00","closed_at":"2026-01-22T20:58:57.998944-10:00","close_reason":"Closed","labels":["swe:code-complete"],"comments":[{"id":33,"issue_id":"dots-0se","author":"kenpo","text":"Code complete - quality gates passed, ready for PR and merge","created_at":"2026-01-23T06:49:48Z"}]}
{"id":"dots-79y","title":"code-complete announcement shows [BEAD_ID] placeholder instead of actual ID","description":"When /dots-swe:code-complete finishes successfully, it shows next steps with a placeholder instead of the actual bead ID.\n\n**Expected Output:**\n```\nRun /dots-swe:code-integrate dots-abc --local for local merge with tests\n```\n\n**Actual Output:**\n```\nRun /dots-swe:code-integrate [BEAD_ID] --local for local merge with tests\n```\n\n**Impact:**\n- User cannot copy-paste the command directly\n- Must manually replace [BEAD_ID] with actual ID\n- Poor UX - the script knows the bead ID but doesn't use it\n- Inconsistent with other commands that show actual values\n\n**Expected Behavior:**\nThe code-complete script should:\n1. Get the current bead ID (from .swe-bead file or git branch)\n2. Show the actual bead ID in all command suggestions\n3. Make commands directly copy-pasteable\n\n**Example of correct output:**\n```\n✅ Code Complete!\n\nNext Steps:\n  Run /dots-swe:code-integrate dots-cdi --remote for GitHub PR workflow\n  Run /dots-swe:code-integrate dots-cdi --local for local merge with tests\n  Check integration status with /dots-swe:code-integrate-status\n```\n\n**Files to modify:**\n- dots-swe/scripts/code-complete.sh (replace [BEAD_ID] with actual ID from get_current_bead)\n- dots-swe/commands/code-complete.md (update output text)","notes":"**Exact Fix:**\n\nIn dots-swe/commands/code-complete.md, lines 238-242, change:\n\n```bash\n# BEFORE:\n!echo \"  - For GitHub PR workflow:\"\n!echo \"    /dots-swe:code-integrate --remote\"\n!echo \"\"\n!echo \"  - For local merge (with tests):\"\n!echo \"    /dots-swe:code-integrate --local\"\n\n# AFTER:\n!echo \"  - For GitHub PR workflow:\"\n!echo \"    /dots-swe:code-integrate $BEAD_ID --remote\"\n!echo \"\"\n!echo \"  - For local merge (with tests):\"\n!echo \"    /dots-swe:code-integrate $BEAD_ID --local\"\n```\n\nThe BEAD_ID variable is already available (set at line 258), just needs to be used in the output.","status":"closed","priority":2,"issue_type":"bug","owner":"robert@sidequest.vip","created_at":"2026-01-22T16:12:45.674833-10:00","created_by":"kenpo","updated_at":"2026-01-22T17:42:50.761329-10:00","closed_at":"2026-01-22T17:42:50.761329-10:00","close_reason":"Closed","comments":[{"id":31,"issue_id":"dots-79y","author":"kenpo","text":"Code complete - quality gates passed, ready for PR and merge","created_at":"2026-01-23T02:19:05Z"}]}
{"id":"dots-a9d","title":"Fix overly restrictive allowed-tools in commands","description":"Several dots-swe commands have overly restrictive allowed-tools (Bash(bash:*)) that cause approval prompts when their scripts call other commands like git, bd, grep, etc.","design":"## Problem\nCommands that delegate to shell scripts have `Bash(bash:*)` which restricts to only the bash command itself. The scripts they call use many other commands (git, bd, grep, sed, jq, zmx, etc.) which trigger approval prompts.\n\n## Affected Commands\n1. code-integrate-status.md: Bash(bash:*)\n2. code-integrate.md: Bash(bash:*)\n3. delete.md: Bash(bash:*)\n4. dispatch.md: Bash(bash:*)\n5. continue.md: Bash(bash:*), Bash(zmx:*), Bash(tmux:*)\n\nAll use execution-mode: atomic-bash and delegate to scripts.\n\n## Solution\nChange all to `allowed-tools: Bash` (or `[\"Bash\"]`):\n\nThis matches the pattern used by working commands:\n- code-complete.md: [\"Bash\"]\n- doctor.md: [\"Bash\"]\n- help.md: [\"Bash\"]\n- prime.md: [\"Bash\"]\n- process-check.md: [\"Bash\"]\n- ready.md: Bash (just fixed)\n\n## Files to Modify\n- dots-swe/commands/code-integrate-status.md (line 2)\n- dots-swe/commands/code-integrate.md (line 2)\n- dots-swe/commands/delete.md (line 2)\n- dots-swe/commands/dispatch.md (line 2)\n- dots-swe/commands/continue.md (line 2)\n\nChange from:\n```yaml\nallowed-tools: Bash(bash:*)\n```\n\nTo:\n```yaml\nallowed-tools: Bash\n```\n\nOr for continue.md, from:\n```yaml\nallowed-tools: Bash(bash:*), Bash(zmx:*), Bash(tmux:*), AskUserQuestion\n```\n\nTo:\n```yaml\nallowed-tools: Bash, AskUserQuestion\n```","acceptance_criteria":"- code-integrate-status.md has allowed-tools: Bash\n- code-integrate.md has allowed-tools: Bash\n- delete.md has allowed-tools: Bash\n- dispatch.md has allowed-tools: Bash\n- continue.md has allowed-tools: Bash, AskUserQuestion\n- All commands run without approval prompts\n- Commands still execute in atomic-bash mode","status":"closed","priority":1,"issue_type":"bug","owner":"robert@sidequest.vip","created_at":"2026-01-22T21:31:34.062174-10:00","created_by":"kenpo","updated_at":"2026-01-22T21:48:40.434826-10:00","closed_at":"2026-01-22T21:48:40.434826-10:00","close_reason":"Closed","comments":[{"id":36,"issue_id":"dots-a9d","author":"kenpo","text":"Code complete - quality gates passed, ready for PR and merge","created_at":"2026-01-23T07:33:58Z"}]}
{"id":"dots-cdi","title":"SWE agent fails on startup: beads database not synced in new worktree","description":"When a new worktree is created via /dots-swe:dispatch, the SWE agent cannot read bead details on startup because the beads database is out of sync with the JSONL file.\n\n**Error on first bd command:**\n```\nError: Database out of sync with JSONL. Run 'bd sync --import-only' to fix.\n\nThe JSONL file has been updated (e.g., after 'git pull') but the database\nhasn't been imported yet. This would cause you to see stale/incomplete data.\n```\n\n**Expected Behavior:**\n1. Agent starts in new worktree\n2. Agent can immediately run `bd show \u003cbead-id\u003e` to get task details\n3. Agent announces work context and begins implementation\n\n**Actual Behavior:**\n1. Agent starts in new worktree\n2. First `bd show` command fails with database sync error\n3. Agent must manually run `bd sync --import-only` before proceeding\n4. This breaks the initial work announcement flow\n\n**Root Cause:**\nThe dispatch script copies .beads/issues.jsonl to the worktree but doesn't initialize/import the beads database. The local SQLite database (`~/.beads/\u003crepo\u003e/db.sqlite` or similar) is either missing or stale.\n\n**Impact:**\n- P0 (Critical) - Blocks ALL agent startup flows\n- Prevents the dots-n4v feature (work announcement on Go!) from working\n- Requires manual intervention on every dispatch\n- Poor developer experience\n\n**Fix Required:**\nIn dots-swe/scripts/dispatch.sh, after creating the worktree and copying .beads/issues.jsonl:\n1. Run `bd sync --import-only` to initialize the database\n2. OR ensure beads database is properly initialized in the worktree context\n3. Verify agent can run bd commands before opening the session\n\n**Files to modify:**\n- dots-swe/scripts/dispatch.sh (add bd sync --import-only after worktree setup)\n- Consider adding this to session-start.sh hook as well","notes":"**Exact Fix Location:**\n\nAdd to dots-swe/scripts/prime.sh at the beginning (after initial checks, before building context):\n\n```bash\n# Sync beads database from JSONL (worktrees may have stale db)\nif [ -f \".beads/issues.jsonl\" ]; then\n  bd sync --import-only \u003e/dev/null 2\u003e\u00261 || {\n    echo \"Warning: Failed to sync beads database\" \u003e\u00262\n  }\nfi\n```\n\nThis ensures:\n1. The beads database is synced on session start\n2. Agent can immediately run bd commands\n3. Worktree sessions have access to latest bead data\n4. Silent operation (only shows warning on error)\n\n**Alternative Location:**\nCould also add to session-start.sh before calling prime.sh, but prime.sh is better because:\n- It's called by both SessionStart hook and manual /dots-swe:prime\n- Centralizes the sync logic in one place\n- Works for all agent startup scenarios","status":"closed","priority":0,"issue_type":"bug","owner":"robert@sidequest.vip","created_at":"2026-01-22T16:07:50.567447-10:00","created_by":"kenpo","updated_at":"2026-01-22T16:32:17.818757-10:00","closed_at":"2026-01-22T16:32:17.818757-10:00","close_reason":"Closed","labels":["swe:code-complete"],"comments":[{"id":29,"issue_id":"dots-cdi","author":"kenpo","text":"Code complete - quality gates passed, ready for PR and merge","created_at":"2026-01-23T02:16:35Z"}]}
{"id":"dots-claude-plugins-2xm","title":"Use AskUserQuestion in continue command for session selection","description":"When `/dots-swe:continue` is run without a bead ID, it currently just lists the available sessions. \n\nEnhancement: Use AskUserQuestion to present the list of active beads/worktrees as selectable options instead of just listing them.\n\nThis provides a better UX by allowing users to select from available sessions interactively.","status":"closed","priority":2,"issue_type":"feature","owner":"objectiveous@gmail.com","created_at":"2026-01-17T14:51:43.589495-06:00","created_by":"Robert (Kenpo) Evans","updated_at":"2026-01-17T14:54:04.9832-06:00","closed_at":"2026-01-17T14:54:04.9832-06:00","close_reason":"Implemented interactive session selection using AskUserQuestion. Continue command now presents available sessions as options when no bead ID is provided. Added --format=json flag to continue.sh for programmatic parsing. Version bumped to 1.2.0."}
{"id":"dots-claude-plugins-3e5","title":"Claude calls Skill tool when command already loaded","description":"## Bug\n\nWhen user invokes a skill directly (e.g., `/dots-swe:status`), the system loads the skill with `\u003ccommand-message\u003e` and `\u003ccommand-name\u003e` tags. According to system instructions, Claude should NOT call the Skill tool in this case - the skill is already loaded.\n\n**Current Behavior:**\n1. User types `/dots-swe:status`\n2. System injects skill content with `\u003ccommand-name\u003e/dots-swe:status\u003c/command-name\u003e`\n3. Claude calls the Skill tool anyway\n4. Skill tool returns \"Launching skill: dots-swe:status\" (no output)\n5. System re-sends the skill content\n6. Claude finally executes the bash command\n\n**Expected Behavior:**\n1. User types `/dots-swe:status`\n2. System injects skill content with `\u003ccommand-name\u003e` tag\n3. Claude sees the tag and immediately executes the `!bash` command\n4. Output is shown to user\n\n**Root Cause:**\nClaude system prompt says: \"If you see a \u003ccommand-name\u003e tag in the current conversation turn, the skill has ALREADY been loaded and its instructions follow in the next message. Do NOT call this tool - just follow the skill instructions directly.\"\n\nClaude is not following this instruction.\n\n**Impact:**\n- Extra round trip (wasted context/time)\n- No output shown until user interrupts\n- Confusing UX\n\n## Acceptance Criteria\n\n- [ ] Update claude-instructions in skill files to clarify when to use Skill tool vs when skill is already loaded\n- [ ] Add clear guidance: if `\u003ccommand-name\u003e` tag present, execute bash directly\n- [ ] Test with `/dots-swe:status` to verify immediate output\n- [ ] Document the pattern for all skill authors","status":"closed","priority":1,"issue_type":"bug","owner":"objectiveous@gmail.com","created_at":"2026-01-18T23:15:57.368207-06:00","created_by":"Robert (Kenpo) Evans","updated_at":"2026-01-18T23:24:54.781723-06:00","closed_at":"2026-01-18T23:24:54.781723-06:00","close_reason":"Closed"}
{"id":"dots-claude-plugins-3xn","title":"Include bead ID in task completion message","description":"## Enhancement\n\nUpdate the completion message format to include the bead ID.\n\n**Current:**\n\"The work completed for this task includes\"\n\n**Desired:**\n\"The work completed for task [BEAD_ID] includes\"\n\n## Acceptance Criteria\n\n- [ ] Find where this message is generated (likely in SWE agent or completion workflow)\n- [ ] Update message template to include the bead ID variable\n- [ ] Verify message shows correctly with actual bead ID","status":"closed","priority":3,"issue_type":"task","owner":"objectiveous@gmail.com","created_at":"2026-01-18T21:47:44.51905-06:00","created_by":"Robert (Kenpo) Evans","updated_at":"2026-01-18T23:06:54.101897-06:00","closed_at":"2026-01-18T23:06:54.101897-06:00","close_reason":"Closed","comments":[{"id":3,"issue_id":"dots-claude-plugins-3xn","author":"Robert (Kenpo) Evans","text":"Code complete - quality gates passed, ready for PR and merge","created_at":"2026-01-19T05:00:28Z"}]}
{"id":"dots-claude-plugins-415","title":"[BUG] worktree-create skill loops don't execute - \\! prefix only works on single lines","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-03T12:34:10.324425-06:00","created_by":"robert","updated_at":"2026-01-03T12:55:29.932782-06:00","closed_at":"2026-01-03T12:55:29.932782-06:00","close_reason":"Fixed by moving loop logic to library functions in worktree-lib.sh","comments":[{"id":1,"issue_id":"dots-claude-plugins-415","author":"robert","text":"## Problem\n\nThe `!for` loop syntax in skill markdown doesn't work as intended. Only lines that directly start with `!` are executed as bash commands. The body of loops is displayed as text but NOT executed.\n\n## Example (worktree-create.md)\n\n```markdown\n!for branch in \"$@\"; do\n  BRANCH_NAME=\"$branch\"\n  git worktree add -b \"$BRANCH_NAME\" \"$WORKTREE_DIR\" \"$CURRENT_BRANCH\"  # NOT EXECUTED\ndone\n```\n\nThe `git worktree add` inside the loop never runs - it's just echoed as text. The skill appears to succeed but no worktree is created.\n\n## Affected Commands\n\n- `/dots-dev:worktree-create`\n- `/dots-dev:worktree-delete` \n- Likely others using for loops\n\n## Fix\n\nRefactor skills to use helper functions in `scripts/worktree-lib.sh` instead of inline loops.","created_at":"2026-01-03T18:34:33Z"}]}
{"id":"dots-claude-plugins-4y0","title":"Fix get_integration_resources undefined in code-integrate.sh","description":"## Bug\n\nThe code-integrate.sh script calls `get_integration_resources` at line 240, but this function is not defined in swe-lib.sh.\n\n## Error\n\n```\n/Users/robert/.claude/plugins/cache/dots-claude-plugins/dots-swe/2.9.2/scripts/code-integrate.sh: line 240: get_integration_resources: command not found\n```\n\n## Impact\n\nMinor - the integration completes successfully, but the error message is confusing.\n\n## Fix\n\nEither:\n1. Remove the call to `get_integration_resources` if it's dead code\n2. Implement the function in swe-lib.sh if it's needed\n\n## Location\n\n- dots-swe/scripts/code-integrate.sh:240\n- dots-swe/scripts/swe-lib.sh (missing function)","status":"closed","priority":2,"issue_type":"bug","owner":"objectiveous@gmail.com","created_at":"2026-01-18T15:49:01.55026-06:00","created_by":"Robert (Kenpo) Evans","updated_at":"2026-01-18T21:45:30.817728-06:00","closed_at":"2026-01-18T21:45:30.817728-06:00","close_reason":"Closed"}
{"id":"dots-claude-plugins-4z1","title":"Tabs are not removed during integration","description":"When running /dots-swe:code-integrate, the Ghostty tabs (zmx sessions) are not being closed/removed after successful integration.\n\nCurrent behavior:\n- code-integrate kills the zmx session\n- But the Ghostty tab remains open\n- User has to manually close tabs after integration\n\nExpected behavior:\n- When code-integrate succeeds, the associated Ghostty tab should close automatically\n- This should happen after killing the zmx session\n\nImpact:\n- After integrating multiple beads, users are left with many empty/dead tabs\n- Manual cleanup is tedious and error-prone\n- Reduces the value of automated integration workflow\n\nFiles to investigate:\n- dots-swe/scripts/code-integrate.sh (cleanup section)\n- dots-swe/scripts/swe-lib.sh (zmx session management)\n\nPossible solutions:\n1. Use Ghostty-specific commands to close tabs\n2. Send exit command to the shell before killing zmx session\n3. Use AppleScript to close specific Ghostty tabs by title/identifier","status":"closed","priority":1,"issue_type":"bug","owner":"objectiveous@gmail.com","created_at":"2026-01-18T22:57:01.943018-06:00","created_by":"Robert (Kenpo) Evans","updated_at":"2026-01-18T23:28:30.082131-06:00","closed_at":"2026-01-18T23:28:30.082131-06:00","close_reason":"Closed","comments":[{"id":4,"issue_id":"dots-claude-plugins-4z1","author":"Robert (Kenpo) Evans","text":"## Solution Implemented\n\nAdded automatic Ghostty tab closing during integration cleanup.\n\n**Implementation:**\n1. Created `close_ghostty_tab()` function in swe-lib.sh that uses AppleScript to find and close tabs by session name/title\n2. Integrated tab closing into both:\n   - `code-integrate.sh`: Closes tabs before killing zmx sessions during integration\n   - `delete_worktrees()`: Closes tabs when deleting worktrees via /dots-dev:worktree-delete\n3. Updated help text and dry-run messages to reflect new behavior\n\n**Key Features:**\n- Uses existing AppleScript permission checking infrastructure\n- Fails gracefully if permissions unavailable (doesn't block integration)\n- Matches tab title pattern used when creating tabs\n- Works for both integration and manual worktree deletion workflows\n\n**Testing Approach:**\nTo test manually:\n1. Create a worktree with /dots-swe:dispatch or /dots-dev:worktree-from-bead\n2. Complete work and run /dots-swe:code-complete\n3. Run /dots-swe:code-integrate --local \u003cbead-id\u003e\n4. Verify that the Ghostty tab closes automatically\n\n**Files Modified:**\n- dots-swe/scripts/swe-lib.sh: Added close_ghostty_tab() function, updated delete_worktrees()\n- dots-swe/scripts/code-integrate.sh: Integrated tab closing, updated help text","created_at":"2026-01-19T05:25:10Z"}]}
{"id":"dots-claude-plugins-5va","title":"Add dependency visualization for beads","description":"## Feature\n\nCreate a visual representation of bead dependencies to help understand project structure and identify blockers.\n\n**Goal:**\nMake it easy to see dependency chains, identify blocking relationships, and understand epic hierarchies at a glance.\n\n**Proposed Implementation:**\n\n**Option A: New Command** (`/dots-swe:deps`)\n- ASCII tree view showing dependency graph\n- Highlight ready vs blocked beads\n- Show epic relationships\n\n**Option B: Enhance Existing Commands**\n- Add `--deps` flag to `bd show`\n- Add dependency graph section to `/dots-swe:status`\n- Integrate into `bd ready` output\n\n**Visualization Format:**\n- ASCII art tree (works in terminal)\n- Optional: generate Mermaid/Graphviz for rich docs\n- Color coding for status (ready/blocked/in_progress)\n\n**Features:**\n1. Show transitive dependencies (A blocks B blocks C)\n2. Identify critical path (longest dependency chain)\n3. Highlight circular dependencies (if any)\n4. Filter by epic, status, priority\n5. Show reverse dependencies (what depends on this)\n\n**Example Output:**\n```\ndots-claude-plugins-epic-1\n├─ dots-claude-plugins-abc [ready] ✓\n│  └─ dots-claude-plugins-def [blocked] ⏸\n│     └─ dots-claude-plugins-ghi [blocked] ⏸\n└─ dots-claude-plugins-xyz [in_progress] ◐\n```\n\n**Technical Approach:**\n1. Query beads database for dependency edges\n2. Build directed acyclic graph (DAG)\n3. Use tree traversal for ASCII rendering\n4. Add to swe-lib.sh as reusable function\n\n**Acceptance Criteria:**\n- [ ] Can visualize dependencies for a single bead\n- [ ] Can show full project dependency graph\n- [ ] Clearly indicates blocked vs ready beads\n- [ ] Works with epic hierarchies\n- [ ] Performance is acceptable for 100+ beads\n- [ ] Integrates cleanly with existing commands","status":"closed","priority":2,"issue_type":"feature","owner":"objectiveous@gmail.com","created_at":"2026-01-18T23:36:59.259767-06:00","created_by":"Robert (Kenpo) Evans","updated_at":"2026-01-19T00:08:06.984716-06:00","closed_at":"2026-01-19T00:08:06.984716-06:00","close_reason":"Closed","comments":[{"id":5,"issue_id":"dots-claude-plugins-5va","author":"Robert (Kenpo) Evans","text":"Implementation complete. Created /dots-swe:deps command with:\n- Project overview mode showing epics, blocked issues, and ready work\n- Single bead mode with full dependency tree and status indicators\n- Mermaid diagram export for documentation\n- Enhanced /dots-swe:status with dependency summary\n- Updated help and beads documentation\n- Version bumped to 2.13.0\n\nAll acceptance criteria met.","created_at":"2026-01-19T05:48:17Z"},{"id":6,"issue_id":"dots-claude-plugins-5va","author":"Robert (Kenpo) Evans","text":"Code complete - quality gates passed, ready for PR and merge","created_at":"2026-01-19T06:05:19Z"}]}
{"id":"dots-claude-plugins-61q","title":"code-complete should rebase onto main before marking complete","description":"## Problem\n\nWhen running `/dots-swe:code-complete`, branches are marked complete without rebasing onto current main. This causes merge conflicts during integration if main has advanced.\n\n**Example:**\n- Branch created from main at commit A\n- Work completed on branch\n- Main advances to commit D (other work integrated)\n- `/dots-swe:code-complete` runs - pushes branch, adds label\n- `/dots-swe:code-integrate --local` fails due to conflicts\n- Manual rebase required before integration succeeds\n\n## Solution\n\nUpdate `/dots-swe:code-complete` to:\n1. Fetch latest from origin\n2. Rebase current branch onto origin/main\n3. Run quality gates (test/lint/build)\n4. Push to remote\n5. Add swe:code-complete label\n\nThis ensures branches are always ready to integrate cleanly.\n\n## Acceptance Criteria\n\n- [ ] code-complete.sh fetches origin before running checks\n- [ ] Rebases onto origin/main (with --force-with-lease push if needed)\n- [ ] Aborts if rebase has conflicts, instructs user to resolve\n- [ ] Quality gates run on rebased code\n- [ ] Integration succeeds without manual rebase\n- [ ] Test with divergent branch scenario","status":"closed","priority":2,"issue_type":"feature","owner":"objectiveous@gmail.com","created_at":"2026-01-18T21:57:01.954157-06:00","created_by":"Robert (Kenpo) Evans","updated_at":"2026-01-18T23:10:36.831935-06:00","closed_at":"2026-01-18T23:10:36.831935-06:00","close_reason":"Closed","comments":[{"id":7,"issue_id":"dots-claude-plugins-61q","author":"Robert (Kenpo) Evans","text":"Implementation complete: code-complete now fetches and rebases onto origin/main before running quality gates","created_at":"2026-01-19T04:56:54Z"}]}
{"id":"dots-claude-plugins-65l","title":"SWE agents skip quality gates before committing","description":"## Problem\n\nSWE agents (including Claude) consistently skip quality gates (process-check/code-complete) before committing code, despite having guidance to run them. This defeats the purpose of having automated quality checks.\n\n**Recent Example:**\n- dots-claude-plugins-ztt: Fixed Skill tool hanging bug\n- Changes: Modified 11 command files + created documentation\n- Committed and closed bead WITHOUT running quality gates\n- No tests, no lint, no verification the fix actually works\n\n## Root Cause Analysis\n\n### 1. bd prime's SESSION CLOSE PROTOCOL is Incomplete\n\nThe `bd prime` command (from beads-marketplace) outputs a SESSION CLOSE PROTOCOL that does NOT include quality gates:\n\n**Current output (ephemeral branch mode):**\n```\n[ ] 1. git status              (check what changed)\n[ ] 2. git add \u003cfiles\u003e         (stage code changes)\n[ ] 3. bd sync --from-main     (pull beads updates from main)\n[ ] 4. git commit -m \"...\"     (commit code changes)\n```\n\n**What's missing:** Step 0 should be \"Run quality gates\"\n\n### 2. Competing/Conflicting Guidance\n\nMultiple sources provide guidance, creating confusion:\n\n- **bd prime SESSION CLOSE PROTOCOL**: No quality gates mentioned\n- **.swe-context Quick Reference**: Says \"Run /dots-swe:process-check before committing\"\n- **.swe-context Quality Checklist**: Has checkboxes but no enforcement\n- **CLAUDE.md Session Completion Protocol**: Mentions quality gates but less prominent\n\nAgents follow the most prominent/structured checklist (SESSION CLOSE PROTOCOL) which is incomplete.\n\n### 3. No Enforcement Mechanism\n\nNothing prevents commits without quality gates:\n- No pre-commit hooks to verify\n- No TodoWrite template that includes quality gates step\n- Acceptance criteria in beads don't include \"run quality gates\" by default\n- Agents create implementation todos but don't add \"verify with tests\" as final step\n\n### 4. bd prime is Not Our Code\n\nThe `bd prime` command lives in `beads-marketplace` (Steve Yegge's repo), not `dots-claude-plugins`. We cannot modify it directly.\n\n**Source:** `/Users/robert/.claude/plugins/marketplaces/beads-marketplace/cmd/bd/prime.go`\n\n## Impact\n\n- **Quality Issues**: Code committed without verification\n- **Broken Fixes**: Changes that might not actually work\n- **Protocol Violation**: Defeats purpose of having /dots-swe:process-check and /dots-swe:code-complete\n- **Normalization**: If agents skip it once, they'll keep skipping it\n- **Wasted Effort**: Bugs that should be caught in development slip through\n\n## Why This Happened on dots-claude-plugins-ztt\n\n1. Agent created todo list: \"Fix files\", \"Document pattern\", \"Commit changes\"\n2. No todo added for \"Run quality gates\"\n3. Followed bd prime's SESSION CLOSE PROTOCOL checklist (no quality gates)\n4. Ignored .swe-context guidance (less structured, buried in middle of file)\n5. No enforcement stopped the commit\n6. Result: Committed untested changes, closed bead\n\n## Proposed Solution\n\n**Create our own prime command in dots-swe that replaces bd prime's output**\n\n```\ndots-swe/commands/prime.md\n```\n\nThis command would:\n1. Call bd prime to get base context\n2. Override/inject the SESSION CLOSE PROTOCOL with our enhanced version\n3. Include quality gates as Step 0 (mandatory)\n4. Adapt based on project type (skip if no tests/lint detected)\n\n**Enhanced SESSION CLOSE PROTOCOL (ephemeral branch):**\n```\n[ ] 0. Run quality gates        (/dots-swe:process-check OR /dots-swe:code-complete)\n[ ] 1. git status              (check what changed)\n[ ] 2. git add \u003cfiles\u003e         (stage code changes)\n[ ] 3. bd sync --from-main     (pull beads updates from main)\n[ ] 4. git commit -m \"...\"     (commit code changes)\n```\n\n**Implementation Strategy:**\n- Make it a SessionStart hook in dots-swe (runs instead of bd prime)\n- Detect if project has tests/lint (Makefile, package.json, etc.)\n- Output appropriate protocol based on context\n- Keep compatibility with bd prime's modes (MCP, stealth, ephemeral)\n\n## Alternative Solutions Considered\n\n1. **Pre-commit git hook**: Too restrictive, blocks agent autonomy\n2. **TodoWrite template**: Agents don't always use TodoWrite for all tasks\n3. **Update .swe-context**: Already has guidance, agents ignore it\n4. **Update CLAUDE.md**: Less effective than prominent checklist\n5. **Modify bd prime**: Not our code, can't change it\n\n## Acceptance Criteria\n\n- [ ] Create /dots-swe:prime command that enhances bd prime output\n- [ ] Add quality gates as Step 0 in SESSION CLOSE PROTOCOL\n- [ ] Make it project-aware (detect test/lint/build tools)\n- [ ] Set up as SessionStart hook to replace bd prime\n- [ ] Test with ephemeral branch workflow\n- [ ] Test with MCP mode\n- [ ] Document the override mechanism\n- [ ] Verify agents actually run quality gates before committing\n\n## Files to Create/Modify\n\n- `dots-swe/commands/prime.md` - New command\n- `dots-swe/scripts/prime.sh` - Implementation script\n- `dots-swe/hooks/hooks.json` - Update SessionStart hook\n- `docs/quality-gates-enforcement.md` - Documentation\n\n## Testing Strategy\n\n1. Create test bead with code changes\n2. Agent works on it in worktree with dots-swe:prime\n3. Verify agent sees enhanced SESSION CLOSE PROTOCOL\n4. Confirm agent runs quality gates before committing\n5. Test with project that has no tests (should skip gracefully)","status":"closed","priority":0,"issue_type":"bug","owner":"objectiveous@gmail.com","created_at":"2026-01-18T22:38:44.534541-06:00","created_by":"Robert (Kenpo) Evans","updated_at":"2026-01-18T23:10:36.834744-06:00","closed_at":"2026-01-18T23:10:36.834744-06:00","close_reason":"Closed","labels":["swe:code-complete"],"comments":[{"id":8,"issue_id":"dots-claude-plugins-65l","author":"Robert (Kenpo) Evans","text":"Implementation complete. Created dots-swe:prime command that enhances session context with quality gates enforcement. The enhanced SESSION CLOSE PROTOCOL now includes Step 0 for running quality gates when tests/lint/build are detected. Automatically runs on SessionStart via hooks.","created_at":"2026-01-19T05:00:23Z"},{"id":9,"issue_id":"dots-claude-plugins-65l","author":"Robert (Kenpo) Evans","text":"Code complete - quality gates passed, ready for PR and merge","created_at":"2026-01-19T05:02:46Z"}]}
{"id":"dots-claude-plugins-7vd","title":"[feature] Auto-detect Xcode projects and use sibling worktrees","description":"Worktree creation should auto-detect Xcode projects (*.xcodeproj) and create worktrees as siblings instead of nested in .worktrees/ to avoid Swift Package Manager local dependency path resolution issues. Detection: check for *.xcodeproj in repo root. If found, use ../$(basename $repo)-wt-$name pattern instead of .worktrees/$name pattern.","design":"Detection: Look for *.xcodeproj files in the root of the git repo (e.g., ls *.xcodeproj 2\u003e/dev/null). If found, create worktree as sibling using pattern: ../$(basename $PWD)-wt-$name. Otherwise, use existing nested pattern: .worktrees/$name. Modify the worktree-create skill to add this detection logic before the git worktree add command.","acceptance_criteria":"1. Xcode project (has *.xcodeproj): Creates worktree as sibling (../\u003crepo\u003e-wt-\u003cname\u003e), can build in Xcode without SPM path errors. 2. Non-Xcode project: Creates worktree in .worktrees/\u003cname\u003e as before. 3. Verify with real repos: test with Yap (Xcode) and another non-Xcode repo. 4. Git worktree list shows correct paths for both cases.","status":"closed","priority":2,"issue_type":"feature","owner":"objectiveous@gmail.com","created_at":"2026-01-12T15:52:52.073104-06:00","created_by":"Robert (Kenpo) Evans","updated_at":"2026-01-22T15:38:14.979379-10:00","closed_at":"2026-01-18T22:42:57.211704-06:00"}
{"id":"dots-claude-plugins-87j","title":"Move 'Ready to Integrate' to top of status report with copy-paste command","description":"Improve the status command UX by making integration opportunities more visible and actionable.\n\nRequirements:\n1. Move 'Ready to Integrate' section to be the FIRST section in the status report (before Active Epic)\n2. Add a one-liner command that users can copy/paste to integrate all ready beads\n   - Format: /dots-swe:code-integrate --local bead1 bead2 bead3\n   - Should list all beads with swe:code-complete label\n   - Only show if there are beads ready to integrate\n3. Keep the existing integration section content (worktrees needing finishing, etc.)\n\nFiles to modify:\n- dots-swe/scripts/status.sh\n\nRationale: Integration is the most actionable item and should be surfaced first. Adding a copy-paste command reduces friction for users to complete work.","status":"closed","priority":2,"issue_type":"feature","owner":"objectiveous@gmail.com","created_at":"2026-01-18T22:52:40.990966-06:00","created_by":"Robert (Kenpo) Evans","updated_at":"2026-01-18T23:10:36.836823-06:00","closed_at":"2026-01-18T23:10:36.836823-06:00","close_reason":"Closed"}
{"id":"dots-claude-plugins-8nj","title":"Beads sync.branch configuration error","description":"Beads sync fails with configuration error:\n\n```\nError: sync.branch not configured (run 'bd config set sync.branch \u003cbranch-name\u003e')\n```\n\nThis appears when running doctor or other commands that check sync status. Need to investigate why sync.branch is not properly configured.","status":"closed","priority":2,"issue_type":"bug","owner":"objectiveous@gmail.com","created_at":"2026-01-17T14:48:11.256298-06:00","created_by":"Robert (Kenpo) Evans","updated_at":"2026-01-17T14:51:05.672644-06:00","closed_at":"2026-01-17T14:51:05.672644-06:00","close_reason":"Fixed both issues. Added doctor.sh script that was missing from plugin installation. Updated beads sync check to treat missing sync.branch configuration as informational rather than an error. Version bumped to 1.1.3."}
{"id":"dots-claude-plugins-935","title":"Fix dots plugin manifest command paths","description":"The dots plugin manifest has invalid command paths. Commands must start with './' and end with '.md' according to the plugin validation schema. Need to update the commands array to use proper file paths like './commands/vibe-spawn.md' instead of plain strings like 'vibe-spawn'.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-05T17:10:41.485794-06:00","created_by":"robert","updated_at":"2026-01-05T17:12:19.381229-06:00","closed_at":"2026-01-05T17:12:19.381229-06:00","close_reason":"Fixed plugin manifest command paths to use proper file path format"}
{"id":"dots-claude-plugins-95w","title":"Continue command doesn't properly detect worktrees","description":"The `/dots-swe:continue` command shows sessions as '(no worktree)' even when git worktrees exist.\n\nExample:\n```\nYou have two available sessions you can continue with:\n  1. dots-claude-plugins-7vd (no worktree)\n  2. test (no worktree)\n```\n\nBut `git worktree list` shows:\n```\n/Users/robert/repos/objectiveous/GammaKit/.worktrees/gk-6xv.3  c188130 [gk-6xv.3]\n```\n\nThe continue script isn't properly detecting or associating worktrees with sessions.","status":"closed","priority":2,"issue_type":"bug","owner":"objectiveous@gmail.com","created_at":"2026-01-17T14:40:02.261705-06:00","created_by":"Robert (Kenpo) Evans","updated_at":"2026-01-17T14:43:14.868506-06:00","closed_at":"2026-01-17T14:43:14.868506-06:00","close_reason":"Fixed worktree detection. Continue command now uses lsof to get actual working directory from session PID, allowing it to detect worktrees across all repositories. Version bumped to 1.1.2."}
{"id":"dots-claude-plugins-9az","title":"code-complete should display bead metadata summary at end","description":"## Enhancement\n\nThe `/dots-swe:code-complete` command should always display a summary of the bead's metadata at the very end of all output messages.\n\n**Current Behavior:**\nCommand completes but doesn't show clear summary of what bead was marked complete.\n\n**Desired Behavior:**\nAt the end of all output, display:\n```\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nBead Summary\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n\nID:     dots-abc-123\nTitle:  Fix authentication bug in login flow\nType:   bug\nStatus: in_progress (marked swe:code-complete)\nParent: dots-abc-100 - User authentication epic\n```\n\n## Acceptance Criteria\n\n- [ ] code-complete.sh reads .swe-bead to get bead ID\n- [ ] Fetches bead metadata using `bd show \u003cid\u003e`\n- [ ] Displays formatted summary at end of output\n- [ ] Summary includes: ID, Title, Type, Status, Parent (if exists)\n- [ ] Parent shows as \"None\" or omitted if no parent epic\n- [ ] Summary appears after quality gates and push operations\n- [ ] Test with bead that has parent epic\n- [ ] Test with bead that has no parent\n\n## Implementation Notes\n\nCan use `bd show \u003cid\u003e` and parse output, or use `bd show \u003cid\u003e --json` if available.","status":"closed","priority":3,"issue_type":"feature","owner":"objectiveous@gmail.com","created_at":"2026-01-18T21:58:07.311185-06:00","created_by":"Robert (Kenpo) Evans","updated_at":"2026-01-18T23:06:56.517498-06:00","closed_at":"2026-01-18T23:06:56.517498-06:00","close_reason":"Closed","labels":["swe:code-complete"],"comments":[{"id":10,"issue_id":"dots-claude-plugins-9az","author":"Robert (Kenpo) Evans","text":"Code complete - quality gates passed, ready for PR and merge","created_at":"2026-01-19T05:00:22Z"}]}
{"id":"dots-claude-plugins-9gg","title":"Update SWE agent instructions to mandate code-complete before closing beads","description":"## Problem\n\nThe SWE agent instructions (dots-swe/agents/swe.md) do not explicitly mandate running /dots-swe:code-complete before closing beads, leading agents to skip this critical step.\n\nRecent violations:\n- dots-claude-plugins-5va: Closed bead without code-complete\n- dots-claude-plugins-ztt: Closed bead without quality gates\n- Multiple historical instances documented in dots-claude-plugins-65l\n\n## Root Cause Analysis\n\n### Current SWE Agent Guidance Gaps\n\n1. **No explicit code-complete requirement**: swe.md mentions quality gates in abstract terms but doesn't mandate /dots-swe:code-complete as a pre-closing step\n\n2. **Workflow section incomplete**: The workflow example shows:\n   - Load context\n   - Implement changes\n   - Commit with Conventional Commits format\n   - ❌ **MISSING**: Run code-complete before closing\n\n3. **Bead closing guidance absent**: No section on \"How to properly close a bead\" or \"Final steps before completion\"\n\n4. **Quality gates mentioned but not enforced**:\n   - Quality Bar section exists (line ~150)\n   - Mentions test/lint/build\n   - But doesn't tie it to code-complete command\n   - Doesn't say \"run this before closing\"\n\n5. **Command reference scattered**:\n   - /dots-swe:process-check mentioned for interim checks\n   - /dots-swe:code-complete not prominently featured\n   - Distinction between them unclear\n\n6. **Agent behavior pattern**:\n   - Agents implement features correctly\n   - Run tests during development (if prompted)\n   - But skip final verification before saying \"done\"\n   - Jump straight to: commit → close bead → \"complete\"\n\n### Why Agents Skip This Step\n\n**Cognitive pattern**:\n1. Agent completes implementation\n2. Code looks correct\n3. Agent commits changes\n4. Agent marks bead closed\n5. Agent says \"implementation complete\"\n\n**Missing trigger**: Nothing in instructions says \"STOP - run code-complete first\"\n\n**False completion signal**: Committing code feels like \"done\" to the agent\n\n## Solution: Mandatory Code-Complete Section\n\nAdd explicit, impossible-to-miss guidance in swe.md that mandates code-complete before closing beads.\n\n### New Section: \"CRITICAL: Before Closing Any Bead\"\n\nInsert prominently after Quality Bar section (around line ~180):\n\n```markdown\n## CRITICAL: Before Closing Any Bead\n\nYou MUST run `/dots-swe:code-complete` before closing a bead or saying you're \"done\". This is NON-NEGOTIABLE.\n\n### What Code-Complete Does\n\nThe `/dots-swe:code-complete` command is your final quality gate. It:\n\n1. **Runs all quality gates** (if detected):\n   - Tests: Ensures your changes don't break existing functionality\n   - Lint: Verifies code style and catches common errors\n   - Build: Confirms the project builds successfully\n\n2. **Pushes to remote**: Ensures your code is backed up and visible to CI\n\n3. **Labels the bead**: Adds `swe:code-complete` label indicating work is ready for integration\n\n4. **Displays summary**: Shows what was completed for verification\n\n### When to Run Code-Complete\n\nRun `/dots-swe:code-complete` when:\n- ✅ All acceptance criteria are met\n- ✅ All code changes are committed locally\n- ✅ You're about to close the bead\n- ✅ You're about to say \"done\" or \"complete\"\n\n**Before running**:\n1. Squash commits if needed: `/dots-swe:squash`\n2. Ensure all changes committed: `git status` should be clean\n3. Review your changes one final time\n\n**After running**:\n- If it succeeds: Proceed to close bead and integration\n- If it fails: Fix the issue, commit, run code-complete again\n\n### NEVER Do This\n\n❌ **WRONG: Close bead without code-complete**\n```bash\ngit commit -m \"feat: add feature\"\nbd close dots-abc-123\n# Agent: \"Implementation complete!\"\n```\n\n✅ **CORRECT: Code-complete, verify, then close**\n```bash\ngit commit -m \"feat: add feature\"\n/dots-swe:code-complete           # ← REQUIRED STEP\n# ... code-complete runs quality gates, pushes, labels ...\nbd close dots-abc-123              # Only after code-complete succeeds\n```\n\n### Why This Matters\n\nSkipping code-complete means:\n- ❌ Untested code gets merged\n- ❌ Build failures discovered during integration (too late)\n- ❌ Wasted time fixing issues that should have been caught earlier\n- ❌ Integration delays for other work\n- ❌ Loss of confidence in quality process\n\n### Quality Gates Failures\n\nIf `/dots-swe:code-complete` fails:\n\n1. **Read the error output carefully**\n2. **Identify which gate failed** (test/lint/build)\n3. **Fix the issue**:\n   - Tests failing: Fix the test or the code\n   - Lint failing: Run linter locally and fix issues\n   - Build failing: Check build errors and resolve\n4. **Commit the fix**\n5. **Run code-complete again**\n6. **Repeat until it passes**\n\n**DO NOT**:\n- ❌ Skip code-complete because \"it's probably fine\"\n- ❌ Close the bead with failing quality gates\n- ❌ Commit code that doesn't pass quality gates\n- ❌ Ask user to \"fix it later\"\n\n### Interim vs Final Checks\n\n**During development**: Use `/dots-swe:process-check`\n- Runs quality gates only\n- No push, no labeling\n- Quick feedback loop\n- Run as often as needed\n\n**Before closing**: Use `/dots-swe:code-complete`\n- Runs quality gates\n- Pushes to remote\n- Labels bead as complete\n- Final verification step\n- Run once when done\n\n### Enforcement\n\nThe workflow has enforcement mechanisms:\n1. **Pre-commit hook**: May prompt if code-complete not run\n2. **Doctor command**: Checks for code-complete label\n3. **Integration command**: Expects code-complete label\n\nThese are safety nets. Don't rely on them. Run code-complete proactively.\n\n### Example: Complete Workflow\n\n```bash\n# 1. Squash commits into logical units\n/dots-swe:squash\n\n# 2. Verify everything committed\ngit status  # Should show clean\n\n# 3. Run code-complete (REQUIRED)\n/dots-swe:code-complete\n\n# Output:\n# ✅ Tests passed (23 tests)\n# ✅ Lint passed\n# ✅ Build passed\n# ✅ Pushed to origin/dots-abc-123\n# ✅ Added swe:code-complete label\n# \n# Bead Summary:\n# ID:     dots-abc-123\n# Title:  Add user authentication\n# Status: ready for integration\n\n# 4. Only now: close the bead\nbd close dots-abc-123\n\n# 5. Integration (usually separate session/later)\n/dots-swe:code-integrate dots-abc-123\n```\n```\n\n### Update Existing Sections\n\n**Workflow section** (around line 42):\nAdd between \"Commit changes\" and \"After completing work\":\n\n```markdown\n### 5. Final Verification\n\nBefore closing the bead, run final quality gates:\n\n\\`\\`\\`bash\n/dots-swe:code-complete\n\\`\\`\\`\n\nThis ensures your work is tested, linted, built, and ready for integration.\n```\n\n**After Completing Work section** (around line 240):\nChange from:\n```markdown\nNext steps:\n- Close the bead: `bd close \u003cbead-id\u003e`\n- Move on to next bead\n```\n\nTo:\n```markdown\nNext steps:\n1. Run final quality gates: `/dots-swe:code-complete`\n2. If code-complete succeeds:\n   - Close the bead: `bd close \u003cbead-id\u003e`\n   - Move on to next bead\n3. If code-complete fails:\n   - Fix the issue\n   - Commit the fix\n   - Run code-complete again\n```\n\n## Why This Works\n\n1. **Impossible to miss**: \"CRITICAL\" header with explicit mandate\n2. **Clear reasoning**: Explains why it matters\n3. **Behavioral guidance**: Shows correct vs incorrect patterns\n4. **Failure handling**: Tells agent what to do when it fails\n5. **Enforcement awareness**: Mentions hooks and checks\n6. **Example workflow**: Shows complete end-to-end pattern\n7. **Repetition**: Mentioned in multiple sections\n8. **Visual emphasis**: ❌ and ✅ symbols, code examples\n\n## Acceptance Criteria\n\n- [ ] Add \"CRITICAL: Before Closing Any Bead\" section after Quality Bar\n- [ ] Section explains what code-complete does (numbered list)\n- [ ] Section shows when to run code-complete (✅ checklist)\n- [ ] Section shows WRONG vs CORRECT patterns (❌/✅ examples)\n- [ ] Section explains why it matters (consequences)\n- [ ] Section covers failure handling (step-by-step)\n- [ ] Section distinguishes process-check vs code-complete\n- [ ] Section shows complete example workflow\n- [ ] Update Workflow section to include code-complete step\n- [ ] Update \"After Completing Work\" section with code-complete requirement\n- [ ] Add enforcement mechanism mentions\n- [ ] Use visual emphasis (❌/✅, CRITICAL, NEVER, MUST)\n- [ ] Test: Agent reads updated swe.md and runs code-complete\n- [ ] Verify section is prominent and impossible to skip\n- [ ] Update version to 2.14.0 (matches protocol change)\n\n## Files to Modify\n\n- `dots-swe/agents/swe.md` - Add CRITICAL section, update workflow\n- `dots-swe/commands/help.md` - Update agent description\n- `dots-swe/.claude-plugin/plugin.json` - Bump version to 2.14.0\n\n## Integration with Other Solutions\n\nThis bead works in conjunction with:\n- **dots-claude-plugins-oz4**: Pre-commit hook (enforcement)\n- **dots-claude-plugins-rkz**: SESSION CLOSE PROTOCOL (checklist)\n\nTogether they create defense in depth:\n1. **Instructions** (this bead): Education and behavioral guidance\n2. **Protocol** (rkz): Visual checklist reminder\n3. **Hook** (oz4): Hard enforcement\n\n## Testing Strategy\n\n1. Update swe.md with new section\n2. Load swe agent in test session\n3. Verify agent sees CRITICAL section\n4. Complete test task\n5. Observe if agent runs code-complete before closing\n6. Test failure scenario (make tests fail)\n7. Verify agent handles failure correctly\n8. Test with agent that hasn't seen new instructions\n9. Compare behavior before/after update\n\n## Success Metrics\n\nBefore change:\n- Agents skip code-complete ~80% of time\n\nTarget after change:\n- Agents skip code-complete \u003c10% of time\n- When skipped, agent catches it before closing bead\n- Failure handling done correctly (fix, commit, retry)\n\n## Rollout Plan\n\n1. Implement changes to swe.md\n2. Bump version to 2.14.0\n3. Test with new sessions\n4. Monitor agent behavior\n5. Iterate on wording if agents still skip\n6. Document in changelog\n\n## Edge Cases\n\n**No quality gates detected**: Code-complete still runs (pushes, labels)\n**Quality gates fail**: Agent should fix and retry, not skip\n**Pre-commit hook not installed**: Agent should still run code-complete\n**GitHub PR workflow**: Slightly different (creates PR instead of local merge)","status":"closed","priority":1,"issue_type":"feature","owner":"objectiveous@gmail.com","created_at":"2026-01-19T00:00:30.236095-06:00","created_by":"Robert (Kenpo) Evans","updated_at":"2026-01-19T00:55:03.913764-06:00","closed_at":"2026-01-19T00:55:03.913764-06:00","close_reason":"Closed","dependencies":[{"issue_id":"dots-claude-plugins-9gg","depends_on_id":"dots-claude-plugins-oz4","type":"relates-to","created_at":"2026-01-19T00:01:00.875929-06:00","created_by":"Robert (Kenpo) Evans"},{"issue_id":"dots-claude-plugins-9gg","depends_on_id":"dots-claude-plugins-rkz","type":"relates-to","created_at":"2026-01-19T00:01:01.046737-06:00","created_by":"Robert (Kenpo) Evans"}],"comments":[{"id":11,"issue_id":"dots-claude-plugins-9gg","author":"Robert (Kenpo) Evans","text":"Part of defense-in-depth strategy with oz4 (hook) and rkz (protocol). This provides education and behavioral guidance via swe.md.","created_at":"2026-01-19T06:00:52Z"},{"id":12,"issue_id":"dots-claude-plugins-9gg","author":"Robert (Kenpo) Evans","text":"Code complete - quality gates passed, ready for PR and merge","created_at":"2026-01-19T06:50:20Z"}]}
{"id":"dots-claude-plugins-d4y","title":"Add .zmx-session to .gitignore","status":"closed","priority":2,"issue_type":"task","owner":"objectiveous@gmail.com","created_at":"2026-01-19T18:45:23.95412-06:00","created_by":"Robert (Kenpo) Evans","updated_at":"2026-01-19T18:55:00.071001-06:00","closed_at":"2026-01-19T18:55:00.071001-06:00","close_reason":"Closed","comments":[{"id":13,"issue_id":"dots-claude-plugins-d4y","author":"Robert (Kenpo) Evans","text":"Code complete - quality gates passed, ready for PR and merge","created_at":"2026-01-20T00:52:35Z"}]}
{"id":"dots-claude-plugins-e7o","title":"[TASK] Create dots-claude-plugins marketplace","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-03T10:40:01.852298-06:00","created_by":"robert","updated_at":"2026-01-03T11:42:01.850346-06:00","closed_at":"2026-01-03T11:42:01.850346-06:00","close_reason":"Merged PR #1 - comprehensive dots-dev plugin with 10 new commands, tutorial, and documentation"}
{"id":"dots-claude-plugins-nm2","title":"Fix commit and merge hygiene to follow Conventional Commits","design":"## Problem\nCurrent commit/merge practices violate Conventional Commits and will cause problems at scale:\n1. Merge commits use generic messages like 'Merge branch X' instead of summarizing work\n2. No squashing strategy - feature branches dump many micro-commits to main\n3. Commit hook doesn't handle merge commits properly\n4. bd sync commits bypass conventions (LOW PRIORITY)\n\n## Expert Best Practices (2026)\n- Main branch should contain one commit per feature/fix\n- Feature branches can have many commits, but squash before merge\n- Merge commits should follow Conventional Commits format and summarize work\n- Commit hooks should allow/validate merge commits differently\n\n## Design Approach\n\n### 1. Local Merge Workflow (Primary)\nSince only one developer and local CI/CD:\n- Update merge commands to prompt for Conventional Commit message\n- Include summary of branch changes in merge commit body\n- Use --no-ff to preserve branch topology\n\n### 2. Squashing Strategy\n- Add pre-merge squash step to workflow\n- Guide users through interactive rebase\n- Keep main branch clean with logical commits\n\n### 3. Commit Hook Enhancement\n- Detect merge commits (start with 'Merge')\n- Allow merge commits to pass (different validation)\n- Continue validating regular commits\n\n### 4. Documentation Updates\n- Update SWE agent with squash workflow\n- Update all commands to reference squashing\n- Add examples of good merge messages\n\n## Out of Scope\n- GitHub PR title validation (no GitHub CI/CD)\n- GitHub Actions (using local CI/CD)\n- Multi-developer coordination (single dev currently)\n- bd sync commit format (LOW PRIORITY - defer to later)","acceptance_criteria":"## Exit Criteria\n\n### Merge Commits Follow Convention\n- Merge commands generate Conventional Commit messages\n- Merge messages include type(scope): description format\n- Merge commit body summarizes changes from branch\n- Example: 'feat(auth): add OAuth integration' not 'Merge branch oauth'\n\n### Squashing Workflow Implemented\n- Documentation explains when/how to squash commits\n- SWE agent includes squashing in workflow\n- Helper command exists for interactive rebasing\n- Main branch shows clean, logical commit history\n\n### Commit Hook Handles Merges\n- Hook allows merge commits to pass\n- Hook still validates regular commits\n- No false rejections of valid merge commits\n- Can complete a merge without hook errors\n\n### Documentation Updated\n- SWE agent includes squash workflow\n- Merge commands reference Conventional Commits format\n- Examples show good vs bad commit messages\n- Quick reference cards updated\n\n### Manual Testing\nTest 1: Merge with conventional commit message works\nTest 2: Squashing workflow guides through rebase\nTest 3: Hook validation still works for bad messages\nTest 4: Regular conventional commits pass\n\n## Success Metrics\n- Zero non-conventional commits in main branch (except historical)\n- Average 1-3 commits per feature (not 10-20 micro-commits)\n- All merge commits follow type(scope): format\n- Commit hook has 0% false positive rate","status":"closed","priority":2,"issue_type":"epic","owner":"objectiveous@gmail.com","created_at":"2026-01-18T15:03:08.982943-06:00","created_by":"Robert (Kenpo) Evans","updated_at":"2026-01-18T22:43:37.964706-06:00","closed_at":"2026-01-18T22:43:37.964706-06:00","close_reason":"Closed","comments":[{"id":14,"issue_id":"dots-claude-plugins-nm2","author":"Robert (Kenpo) Evans","text":"Code complete - quality gates passed, ready for PR and merge","created_at":"2026-01-19T04:38:17Z"}]}
{"id":"dots-claude-plugins-nm2.1","title":"Update merge commands to use Conventional Commit format","description":"Fix dots-dev/commands/worktree-merge.md to generate proper Conventional Commit merge messages instead of generic 'Merge branch X'.\n\nCurrent: git merge \u003cbranch\u003e --no-ff -m \"Merge branch '\u003cbranch\u003e'\"\nTarget: Prompt for conventional message and include change summary","design":"## Current Implementation\ndots-dev/commands/worktree-merge.md:39 uses generic merge message\n\n## New Implementation\n1. Before merge, show git log main..branch --oneline\n2. Prompt user for Conventional Commit message:\n   - Type (feat/fix/chore/refactor/etc)\n   - Scope (optional)\n   - Description\n3. Generate merge commit with:\n   - Subject: type(scope): description\n   - Body: summary of commits being merged\n   - Footer: 'Merged branch: \u003cbranch-name\u003e'\n\n## Example\nSubject: feat(auth): add OAuth integration\nBody:\n- Add OAuth 2.0 provider configuration\n- Implement token refresh logic\n- Add session management\n\nMerged branch: feature/oauth","acceptance_criteria":"- Merge command prompts for conventional commit info\n- Generated message follows type(scope): description format\n- Merge commit body includes summary of changes\n- Hook validation passes on merge commits\n- Test with actual branch merge completes successfully","status":"closed","priority":1,"issue_type":"task","owner":"objectiveous@gmail.com","created_at":"2026-01-18T15:03:23.272437-06:00","created_by":"Robert (Kenpo) Evans","updated_at":"2026-01-18T15:47:58.698474-06:00","closed_at":"2026-01-18T15:47:58.698474-06:00","close_reason":"Closed","dependencies":[{"issue_id":"dots-claude-plugins-nm2.1","depends_on_id":"dots-claude-plugins-nm2","type":"parent-child","created_at":"2026-01-18T15:03:23.273444-06:00","created_by":"Robert (Kenpo) Evans"}],"comments":[{"id":15,"issue_id":"dots-claude-plugins-nm2.1","author":"Robert (Kenpo) Evans","text":"Code complete: pushed to origin/dots-claude-plugins-nm2.1, ready for PR/merge","created_at":"2026-01-18T21:45:30Z"}]}
{"id":"dots-claude-plugins-nm2.2","title":"Add squashing guidance to workflow documentation","description":"Update SWE agent and workflow docs to include commit squashing best practices.\n\nDevelopers should know when and how to squash commits before merging to keep main branch clean.","design":"## Files to Update\n\n### 1. dots-swe/agents/swe.md\nAdd section after 'Commit Message Format' (around line 167):\n\n**Squashing Commits**\nBefore merging to main, squash feature branch commits into logical units:\n\n\n### 2. dots-swe/commands/ship.md or relevant workflow docs\nAdd pre-ship squashing step\n\n### 3. Quick reference in beads.md or help.md\nAdd squashing to workflow steps\n\n## Guidance to Include\n- Squash locally in feature branch before creating PR or merging\n- One logical commit per feature/fix in main branch\n- Keep detailed commits in feature branch for safety\n- Squash right before final merge\n- Use fixup for trivial commits, squash for combining work","acceptance_criteria":"- SWE agent doc includes squashing section with examples\n- Workflow commands reference squashing step\n- Examples show before/after of good squashing\n- Clear guidance on when to squash (before merge to main)\n- Documentation mentions 'git rebase -i main' command","status":"closed","priority":1,"issue_type":"task","owner":"objectiveous@gmail.com","created_at":"2026-01-18T15:04:33.018178-06:00","created_by":"Robert (Kenpo) Evans","updated_at":"2026-01-18T15:50:29.474891-06:00","closed_at":"2026-01-18T15:50:29.474891-06:00","close_reason":"Closed","dependencies":[{"issue_id":"dots-claude-plugins-nm2.2","depends_on_id":"dots-claude-plugins-nm2","type":"parent-child","created_at":"2026-01-18T15:04:33.019285-06:00","created_by":"Robert (Kenpo) Evans"}],"comments":[{"id":16,"issue_id":"dots-claude-plugins-nm2.2","author":"Robert (Kenpo) Evans","text":"Code complete: pushed to origin/dots-claude-plugins-nm2.2, ready for PR/merge","created_at":"2026-01-18T21:45:50Z"}]}
{"id":"dots-claude-plugins-nm2.3","title":"Update SWE agent with complete squashing workflow","description":"Enhance dots-swe/agents/swe.md to include commit squashing as standard practice.\n\nAdd after quality bar section, integrate into workflow steps, update commit examples.","design":"## Sections to Add/Update\n\n### After 'Commit Message Format' section (~line 167)\nAdd new section: 'Squashing Commits for Clean History'\n\nContent:\n- When to squash (before merge to main)\n- How to squash (git rebase -i main)\n- What to keep (logical commits, not micro-commits)\n- Examples of good squashing\n\n### Update 'Workflow' section (~line 42)\nAdd step between 'verify quality gates' and 'ship':\n- Squash commits into logical units\n\n### Update 'Example Session' section (~line 213)\nShow squashing step before shipping\n\n### Update 'After Completing Work' section (~line 240)\nMention squashing in next steps","acceptance_criteria":"- Squashing section added with clear examples\n- Workflow includes squashing step\n- Example session shows git rebase -i usage\n- Next steps mention checking commit count before shipping\n- Guidance on pick vs squash vs fixup","status":"closed","priority":1,"issue_type":"task","owner":"objectiveous@gmail.com","created_at":"2026-01-18T15:04:46.894449-06:00","created_by":"Robert (Kenpo) Evans","updated_at":"2026-01-18T15:51:18.063542-06:00","closed_at":"2026-01-18T15:51:18.063542-06:00","close_reason":"Closed","dependencies":[{"issue_id":"dots-claude-plugins-nm2.3","depends_on_id":"dots-claude-plugins-nm2","type":"parent-child","created_at":"2026-01-18T15:04:46.89545-06:00","created_by":"Robert (Kenpo) Evans"}],"comments":[{"id":17,"issue_id":"dots-claude-plugins-nm2.3","author":"Robert (Kenpo) Evans","text":"Code complete: pushed to origin/dots-claude-plugins-nm2.3, ready for PR/merge. Also includes SWE agent fix to prohibit direct bead closing.","created_at":"2026-01-18T21:46:11Z"}]}
{"id":"dots-claude-plugins-nm2.4","title":"Create /dots-swe:squash command for interactive rebasing","description":"Add new command that guides users through squashing commits in their feature branch.\n\nMakes it easier to clean up history before merging to main.","design":"## Command: /dots-swe:squash\n\nNew file: dots-swe/commands/squash.md\n\n### Behavior\n1. Check if on feature branch (not main)\n2. Check if branch has commits ahead of main\n3. Show commit count and list\n4. Offer to start interactive rebase\n5. Provide guidance during rebase\n\n### Implementation\nCommits to squash: 3\ndfc930a wip: c\nc900242 wip: b\n59532f2 wip: a\n\nStarting interactive rebase...\nIn the editor:\n  - Keep first commit as 'pick'\n  - Change others to 'squash' (keep message) or 'fixup' (discard message)\n  - Save and close\n  - Write final Conventional Commit message","acceptance_criteria":"- Command exists at dots-swe/commands/squash.md\n- Rejects running on main branch\n- Shows commit count and list\n- Provides clear guidance\n- Launches git rebase -i main\n- Test: run on branch with multiple commits\n- Test: run on main, gets error\n- Test: run with no commits, exits gracefully","status":"closed","priority":2,"issue_type":"task","owner":"objectiveous@gmail.com","created_at":"2026-01-18T15:05:01.78547-06:00","created_by":"Robert (Kenpo) Evans","updated_at":"2026-01-18T22:48:43.156467-06:00","closed_at":"2026-01-18T22:48:43.156467-06:00","close_reason":"Closed","labels":["swe:code-complete"],"dependencies":[{"issue_id":"dots-claude-plugins-nm2.4","depends_on_id":"dots-claude-plugins-nm2","type":"parent-child","created_at":"2026-01-18T15:05:01.78623-06:00","created_by":"Robert (Kenpo) Evans"}],"comments":[{"id":18,"issue_id":"dots-claude-plugins-nm2.4","author":"Robert (Kenpo) Evans","text":"Code complete - quality gates passed, ready for PR and merge","created_at":"2026-01-19T04:37:59Z"}]}
{"id":"dots-claude-plugins-nm2.5","title":"Fix bd sync to use Conventional Commit messages","description":"Update documentation to use 'bd sync --message' with conventional format instead of auto-generated timestamps.\n\nLOWEST PRIORITY - defer until other tasks complete.","design":"## Current Behavior\nbd sync auto-generates commits like:\n  bd sync: 2026-01-18 13:40:45\n\nThese don't follow Conventional Commits format.\n\n## Solution\nUpdate documentation to always use --message flag:\n→ Detected uncommitted JSONL changes (possible incomplete sync)\n→ Re-exporting from database to reconcile state...\n✓ State reconciled\n→ No upstream configured, using --from-main mode\n→ Fetching from origin/main...\n→ Checking out beads from origin/main...\n→ Importing JSONL...\nImport complete: 0 created, 0 updated, 10 unchanged\n\n✓ Sync from main complete\n\n## Files to Update\n1. dots-swe/agents/swe.md:189\n   - Change 'bd sync' to 'bd sync --message \"chore: sync beads database\"'\n\n2. dots-swe/commands/beads.md:67\n   - Update sync example\n\n3. Any other references to 'bd sync' in docs\n\n## Alternative (if too verbose)\nCould create a shell alias:\n\n\n## Note\nThis is LOW PRIORITY because:\n- Only affects sync commits, not code commits\n- Single developer workflow\n- Can be done last after other hygiene improvements","acceptance_criteria":"- All 'bd sync' examples in docs include --message flag\n- Message follows 'chore: sync beads database' format\n- SWE agent uses conventional format\n- Test: run bd sync with --message, commit follows format\n- Optional: shell alias created for convenience","status":"closed","priority":3,"issue_type":"task","owner":"objectiveous@gmail.com","created_at":"2026-01-18T15:05:15.970217-06:00","created_by":"Robert (Kenpo) Evans","updated_at":"2026-01-18T21:56:41.29874-06:00","closed_at":"2026-01-18T21:56:41.29874-06:00","close_reason":"Closed","dependencies":[{"issue_id":"dots-claude-plugins-nm2.5","depends_on_id":"dots-claude-plugins-nm2","type":"parent-child","created_at":"2026-01-18T15:05:15.973009-06:00","created_by":"Robert (Kenpo) Evans"}]}
{"id":"dots-claude-plugins-o2h","title":"Fix skill format in worktree commands","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-03T16:40:12.808216-06:00","created_by":"robert","updated_at":"2026-01-03T16:50:37.137414-06:00","closed_at":"2026-01-03T16:50:37.137414-06:00","close_reason":"Fixed skill format in all 9 worktree commands"}
{"id":"dots-claude-plugins-oz4","title":"Add pre-commit hook to enforce code-complete workflow","description":"## Problem\n\nSWE agents consistently skip /dots-swe:code-complete before committing code, despite documentation and guidance. Recent examples:\n- dots-claude-plugins-5va: Committed without running code-complete\n- dots-claude-plugins-ztt: Committed without quality gates\n- dots-claude-plugins-65l: Root cause analysis of this pattern\n\nThis violates the quality gates protocol and defeats the purpose of having automated quality checks.\n\n## Root Cause Analysis\n\n### Why Agents Skip Code-Complete\n\n1. **No enforcement mechanism**: Nothing blocks commits without code-complete\n2. **Guidance is passive**: SESSION CLOSE PROTOCOL shows checklist but doesn't enforce it\n3. **Multiple competing patterns**: \n   - SESSION CLOSE PROTOCOL says \"Run quality gates\" (ambiguous)\n   - Git workflow is familiar (git add → git commit)\n   - Agents default to standard git workflow when unsure\n4. **Cognitive load**: By the time work is done, agents focus on \"commit and close\" rather than \"verify quality first\"\n5. **False confidence**: When implementation looks correct, agents assume quality is fine\n6. **No immediate feedback**: Skipping code-complete has no immediate negative consequence\n\n### Why This Is Critical\n\n- **Quality regression**: Code committed without tests/lint/build verification\n- **Protocol erosion**: If skipped once, becomes normalized behavior\n- **Integration failures**: Code that breaks during /dots-swe:code-integrate\n- **Wasted effort**: Having to fix issues that should have been caught earlier\n- **Lost benefits**: Defeats entire purpose of quality gates infrastructure\n\n## Solution: Pre-commit Git Hook\n\nCreate interactive pre-commit hook that checks if bead has swe:code-complete label before allowing commit.\n\n### Implementation\n\n**New command**: `/dots-swe:install-quality-hook`\n\nCreates `.git/hooks/pre-commit`:\n\n```bash\n#!/bin/bash\n# Pre-commit hook: Enforce code-complete workflow for SWE beads\n\n# Check if we're in a worktree with a bead\nBEAD_ID=$(cat .swe-bead 2\u003e/dev/null)\n\nif [ -z \"$BEAD_ID\" ]; then\n  # Not a bead worktree, allow commit\n  exit 0\nfi\n\n# Check if bead has swe:code-complete label\nif bd show \"$BEAD_ID\" 2\u003e/dev/null | grep -q \"swe:code-complete\"; then\n  # Has label, all good\n  exit 0\nfi\n\n# Missing swe:code-complete label - prompt user\necho \"\"\necho \"━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\"\necho \"⚠️  Quality Gates Check\"\necho \"━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\"\necho \"\"\necho \"Bead: $BEAD_ID\"\necho \"Status: Missing swe:code-complete label\"\necho \"\"\necho \"Before committing completed work, you should run:\"\necho \"  /dots-swe:code-complete\"\necho \"\"\necho \"This will:\"\necho \"  • Run quality gates (test/lint/build)\"\necho \"  • Push to remote\"\necho \"  • Add swe:code-complete label\"\necho \"  • Verify work is ready for integration\"\necho \"\"\necho \"Options:\"\necho \"  [y] Yes, I ran code-complete (proceed with commit)\"\necho \"  [n] No, let me run it now (abort commit)\"\necho \"  [w] This is WIP, skip for now (proceed with commit)\"\necho \"\"\nread -p \"Continue with commit? [y/n/w]: \" -n 1 -r\necho \"\"\n\ncase \"$REPLY\" in\n  y|Y)\n    echo \"✓ Proceeding with commit\"\n    exit 0\n    ;;\n  w|W)\n    echo \"⚠️  Proceeding with WIP commit (code-complete skipped)\"\n    exit 0\n    ;;\n  *)\n    echo \"❌ Commit aborted\"\n    echo \"\"\n    echo \"Next steps:\"\n    echo \"  1. Run: /dots-swe:code-complete\"\n    echo \"  2. If quality gates pass, commit again\"\n    echo \"\"\n    exit 1\n    ;;\nesac\n```\n\n### Hook Management\n\n**Install**: `/dots-swe:install-quality-hook`\n- Creates/updates pre-commit hook\n- Makes it executable\n- Confirms installation\n\n**Uninstall**: `/dots-swe:uninstall-quality-hook`\n- Removes pre-commit hook\n- Confirms removal\n\n**Check**: Part of `/dots-swe:doctor`\n- Verifies hook is installed\n- Warns if missing\n\n### User Experience\n\n**Scenario 1: Agent tries to commit without code-complete**\n```bash\n$ git commit -m \"feat: add new feature\"\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n⚠️  Quality Gates Check\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n\nBead: dots-abc-123\nStatus: Missing swe:code-complete label\n\nBefore committing completed work, you should run:\n  /dots-swe:code-complete\n\nContinue with commit? [y/n/w]: n\n\n❌ Commit aborted\nRun: /dots-swe:code-complete\n```\n\n**Scenario 2: Agent ran code-complete (label exists)**\n```bash\n$ git commit -m \"feat: add new feature\"\n[branch abc123] feat: add new feature\n```\n(Hook passes silently)\n\n**Scenario 3: WIP commit**\n```bash\nContinue with commit? [y/n/w]: w\n⚠️  Proceeding with WIP commit (code-complete skipped)\n[branch abc123] wip: partial implementation\n```\n\n### Why This Works\n\n1. **Active enforcement**: Blocks commit until acknowledged\n2. **Educational**: Explains why and what to do\n3. **Flexible**: Allows WIP commits when needed\n4. **Non-invasive**: Silent when label exists\n5. **Clear feedback**: Agent knows immediately if they skipped step\n6. **Behavioral training**: Repeated exposure builds habit\n\n### Integration Points\n\n**Dispatch workflow**:\n- Hook automatically installed when creating worktree\n- Part of workspace setup\n\n**Doctor command**:\n- Checks if hook installed\n- Offers to install if missing\n\n**Documentation**:\n- Update workflow docs to mention hook\n- Add troubleshooting section\n\n## Acceptance Criteria\n\n- [ ] Create /dots-swe:install-quality-hook command\n- [ ] Create /dots-swe:uninstall-quality-hook command\n- [ ] Pre-commit hook checks for .swe-bead file\n- [ ] Hook checks for swe:code-complete label via bd show\n- [ ] Interactive prompt with clear options (y/n/w)\n- [ ] Abort commit if user selects 'n'\n- [ ] Allow commit if user selects 'y' or 'w'\n- [ ] Silent pass-through when label exists\n- [ ] Hook is executable (chmod +x)\n- [ ] Update /dots-swe:doctor to check hook status\n- [ ] Update /dots-swe:dispatch to install hook in new worktrees\n- [ ] Test: Commit without label shows prompt\n- [ ] Test: Commit with label passes silently\n- [ ] Test: Selecting 'n' aborts commit\n- [ ] Test: Selecting 'w' allows commit\n- [ ] Document in help.md\n\n## Files to Create/Modify\n\n- `dots-swe/commands/install-quality-hook.md` (new)\n- `dots-swe/commands/uninstall-quality-hook.md` (new)\n- `dots-swe/scripts/install-quality-hook.sh` (new)\n- `dots-swe/scripts/uninstall-quality-hook.sh` (new)\n- `dots-swe/scripts/doctor.sh` (modify - add hook check)\n- `dots-swe/scripts/dispatch.sh` (modify - auto-install hook)\n- `dots-swe/commands/help.md` (modify - document new commands)\n\n## Testing Strategy\n\n1. Create test bead without label\n2. Try to commit - should prompt\n3. Select 'n' - should abort\n4. Run code-complete\n5. Commit again - should pass silently\n6. Test WIP flow with 'w' option\n7. Test hook bypass with --no-verify\n8. Test doctor detection","status":"closed","priority":1,"issue_type":"feature","owner":"objectiveous@gmail.com","created_at":"2026-01-18T23:58:32.242362-06:00","created_by":"Robert (Kenpo) Evans","updated_at":"2026-01-19T18:52:18.167326-06:00","closed_at":"2026-01-19T18:52:18.167326-06:00","close_reason":"Implemented pre-commit hook to enforce code-complete workflow. All acceptance criteria met: created install/uninstall commands, integrated with doctor and dispatch, tested successfully.","labels":["swe:code-complete"],"dependencies":[{"issue_id":"dots-claude-plugins-oz4","depends_on_id":"dots-claude-plugins-rkz","type":"relates-to","created_at":"2026-01-19T00:01:00.706756-06:00","created_by":"Robert (Kenpo) Evans"},{"issue_id":"dots-claude-plugins-oz4","depends_on_id":"dots-claude-plugins-9gg","type":"relates-to","created_at":"2026-01-19T00:01:00.875287-06:00","created_by":"Robert (Kenpo) Evans"}],"comments":[{"id":19,"issue_id":"dots-claude-plugins-oz4","author":"Robert (Kenpo) Evans","text":"Part of defense-in-depth strategy with rkz (protocol) and 9gg (instructions). This provides hard enforcement via git hook.","created_at":"2026-01-19T06:00:52Z"}]}
{"id":"dots-claude-plugins-ram","title":"Tabs should have titles set to bead ID","description":"When dispatching beads and opening new Ghostty tabs, the tab title should be set to the bead ID for easy identification.\n\nCurrently, tabs opened via /dots-swe:dispatch don't have meaningful titles, making it hard to identify which tab corresponds to which bead when multiple tabs are open.\n\nRequirements:\n1. Set tab title to bead ID when opening new Ghostty tabs\n2. Update open_ghostty_zmx_tab function in swe-lib.sh\n3. Title should persist throughout the session\n4. Use terminal escape sequences or Ghostty-specific commands to set title\n\nFiles to modify:\n- dots-swe/scripts/swe-lib.sh (open_ghostty_zmx_tab function)\n\nExample:\n- Tab for bead 'dots-claude-plugins-abc' should show 'dots-claude-plugins-abc' as the tab title\n\nThis improves UX when working with multiple beads simultaneously.","status":"closed","priority":2,"issue_type":"feature","owner":"objectiveous@gmail.com","created_at":"2026-01-18T22:56:20.044296-06:00","created_by":"Robert (Kenpo) Evans","updated_at":"2026-01-18T23:25:06.192489-06:00","closed_at":"2026-01-18T23:25:06.192489-06:00","close_reason":"Closed"}
{"id":"dots-claude-plugins-rkz","title":"Enhance SESSION CLOSE PROTOCOL to explicitly require code-complete","description":"## Problem\n\nThe SESSION CLOSE PROTOCOL displayed by dots-swe:prime is ambiguous about quality gates, leading agents to skip /dots-swe:code-complete before committing.\n\n**Current protocol:**\n```\n[ ] 1. git status              (check what changed)\n[ ] 2. git add \u003cfiles\u003e         (stage code changes)\n[ ] 3. bd sync --from-main     (pull beads updates from main)\n[ ] 4. git commit -m \"...\"     (commit code changes)\n```\n\nMissing: Explicit step to run /dots-swe:code-complete\n\n## Root Cause Analysis\n\n### Why Current Protocol Fails\n\n1. **No mention of code-complete**: Protocol goes straight from \"bd sync\" to \"git commit\"\n2. **Ambiguous quality gates reference**: `.swe-context` mentions \"run process-check before committing\" but:\n   - It's buried in middle of file\n   - Says \"process-check\" not \"code-complete\"\n   - Less prominent than SESSION CLOSE PROTOCOL\n3. **Competing guidance sources**:\n   - SESSION CLOSE PROTOCOL (from prime.sh) - most visible, missing code-complete\n   - .swe-context Quick Reference - mentions process-check\n   - .swe-context Quality Checklist - has checkbox but no enforcement\n   - CLAUDE.md - mentions quality gates but less prominent\n4. **Agent behavior**: Agents follow most structured/prominent guidance\n   - SESSION CLOSE PROTOCOL is in big header box\n   - Presented at session start\n   - Agents treat it as authoritative checklist\n5. **Distinction unclear**: Difference between process-check vs code-complete not explained\n   - process-check: Run quality gates only (interim checks)\n   - code-complete: Quality gates + push + label + bead update (final step)\n\n### Impact\n\n- Agents skip code-complete 80%+ of the time\n- Quality gates bypassed\n- Manual intervention required\n- Pattern becomes normalized\n\n## Solution: Explicit Code-Complete Step\n\nUpdate SESSION CLOSE PROTOCOL to make /dots-swe:code-complete a required, numbered step.\n\n### Enhanced Protocol (Ephemeral Branch Mode)\n\n```\n🚨 SESSION CLOSE PROTOCOL 🚨\n\nCRITICAL: Before saying \"done\" or \"complete\", you MUST run this checklist:\n\n[ ] 0. Run /dots-swe:code-complete\n       ↓ This command does ALL of the following:\n       • Runs quality gates (test/lint/build if detected)\n       • Pushes code to remote (if upstream configured)\n       • Adds swe:code-complete label to bead\n       • Marks work ready for integration\n       ↓ DO NOT proceed to next steps if this fails\n       ↓ Fix issues and run code-complete again\n\n[ ] 1. git status              (verify what changed)\n[ ] 2. git add \u003cfiles\u003e         (stage code changes)  \n[ ] 3. bd sync --from-main     (pull beads updates from main)\n[ ] 4. git commit -m \"...\"     (commit code changes)\n\nNote: This is an ephemeral branch (no upstream). Code is merged to main locally, not pushed.\n\nWhen code-complete fails:\n• Read the error output carefully\n• Fix the failing quality gate (test/lint/build)\n• Run code-complete again\n• Only commit after code-complete succeeds\n```\n\n### Enhanced Protocol (GitHub PR Mode)\n\n```\n🚨 SESSION CLOSE PROTOCOL 🚨\n\nCRITICAL: Before saying \"done\" or \"complete\", you MUST run this checklist:\n\n[ ] 0. Run /dots-swe:code-complete\n       ↓ This command does ALL of the following:\n       • Runs quality gates (test/lint/build if detected)\n       • Pushes code to remote\n       • Creates/updates PR\n       • Adds swe:code-complete label to bead\n       ↓ DO NOT proceed if this fails\n\n[ ] 1. bd sync --from-main     (pull beads updates from main)\n[ ] 2. git status              (verify everything committed and pushed)\n\nNext: Wait for PR review and CI to pass, then run /dots-swe:code-integrate\n```\n\n### Key Changes\n\n1. **Step 0 is code-complete**: Most important step comes first\n2. **Explains what it does**: No ambiguity about what happens\n3. **Shows consequences**: \"DO NOT proceed\" language\n4. **Failure handling**: Tells agent what to do if it fails\n5. **Visual hierarchy**: Arrows show flow, emphasis on criticality\n6. **Mode-specific**: Different protocols for ephemeral vs GitHub workflows\n\n### Implementation\n\n**File**: `dots-swe/scripts/prime.sh`\n\nUpdate the SESSION CLOSE PROTOCOL generation to:\n1. Detect workflow mode (ephemeral vs GitHub PR)\n2. Output appropriate protocol with Step 0\n3. Detect if quality gates exist (test/lint/build)\n4. Adapt messaging based on project type\n\n**Example logic**:\n```bash\n# Detect quality gates\neval \"$(detect_project_commands)\"\nHAS_QUALITY_GATES=\"false\"\n[ -n \"$TEST_CMD\" ] || [ -n \"$LINT_CMD\" ] || [ -n \"$BUILD_CMD\" ] \u0026\u0026 HAS_QUALITY_GATES=\"true\"\n\n# Output protocol\necho \"🚨 SESSION CLOSE PROTOCOL 🚨\"\necho \"\"\necho \"CRITICAL: Before saying \\\"done\\\" or \\\"complete\\\", you MUST run this checklist:\"\necho \"\"\necho \"[ ] 0. Run /dots-swe:code-complete\"\n\nif [ \"$HAS_QUALITY_GATES\" = \"true\" ]; then\n  echo \"       ↓ This runs quality gates:\"\n  [ -n \"$TEST_CMD\" ] \u0026\u0026 echo \"       • Tests: $TEST_CMD\"\n  [ -n \"$LINT_CMD\" ] \u0026\u0026 echo \"       • Lint: $LINT_CMD\"\n  [ -n \"$BUILD_CMD\" ] \u0026\u0026 echo \"       • Build: $BUILD_CMD\"\nelse\n  echo \"       ↓ No quality gates detected (no tests/lint/build)\"\nfi\n\necho \"       • Pushes code to remote\"\necho \"       • Adds swe:code-complete label\"\necho \"       ↓ DO NOT proceed to next steps if this fails\"\n```\n\n### Additional Enhancements\n\n**Color/Emphasis** (if terminal supports):\n- Red/bold for \"CRITICAL\"\n- Yellow/bold for \"DO NOT proceed\"\n- Green for checkboxes\n\n**Validation Helper**:\nAdd quick check command: `/dots-swe:check-protocol`\nShows current step status:\n```\nProtocol Status:\n  [✗] 0. code-complete - NOT RUN (no swe:code-complete label)\n  [?] 1. git status    - unknown\n  [?] 2. git add       - unknown\n  [✓] 3. bd sync       - synced (0 minutes ago)\n  [?] 4. git commit    - unknown\n```\n\n## Why This Works\n\n1. **Prominence**: First thing agents see at session start\n2. **Clarity**: No ambiguity about what to run\n3. **Ordering**: Code-complete BEFORE commit (prevents skip)\n4. **Education**: Explains what code-complete does\n5. **Failure guidance**: Tells agent how to recover\n6. **Reinforcement**: Repeated exposure builds habit\n\n## Acceptance Criteria\n\n- [ ] Update prime.sh to output enhanced SESSION CLOSE PROTOCOL\n- [ ] Step 0 explicitly says \"Run /dots-swe:code-complete\"\n- [ ] Explains what code-complete does (bullets)\n- [ ] Includes \"DO NOT proceed\" warning\n- [ ] Detects workflow mode (ephemeral vs GitHub)\n- [ ] Outputs mode-specific protocol\n- [ ] Detects quality gates and shows which will run\n- [ ] Adapts message if no quality gates detected\n- [ ] Visual hierarchy with arrows (↓) showing flow\n- [ ] Test: prime.sh output in ephemeral mode\n- [ ] Test: prime.sh output in GitHub mode\n- [ ] Test: prime.sh with quality gates detected\n- [ ] Test: prime.sh with no quality gates\n- [ ] Update .swe-context template to match\n- [ ] Document protocol in help.md\n\n## Files to Modify\n\n- `dots-swe/scripts/prime.sh` - Enhanced protocol generation\n- `dots-swe/commands/prime.md` - Update documentation\n- `dots-swe/commands/help.md` - Document protocol\n\n## Testing Strategy\n\n1. Run /dots-swe:prime in project with tests\n2. Verify Step 0 shows code-complete\n3. Verify quality gates listed\n4. Run in project without tests\n5. Verify \"no quality gates\" message\n6. Test ephemeral mode message\n7. Test GitHub mode message\n8. Verify protocol appears in session startup\n\n## Rollout Considerations\n\n**Version**: Bump to 2.14.0 (protocol change is significant)\n\n**Backward compatibility**: None needed (pure addition)\n\n**Migration**: Existing sessions won't see new protocol until:\n- Session restart, or\n- Manual run of /dots-swe:prime\n\n**Communication**: \n- Update README with new protocol\n- Add changelog entry","status":"closed","priority":1,"issue_type":"feature","owner":"objectiveous@gmail.com","created_at":"2026-01-18T23:59:23.102032-06:00","created_by":"Robert (Kenpo) Evans","updated_at":"2026-01-19T19:01:17.344277-06:00","closed_at":"2026-01-19T19:01:17.344277-06:00","close_reason":"Closed","dependencies":[{"issue_id":"dots-claude-plugins-rkz","depends_on_id":"dots-claude-plugins-oz4","type":"relates-to","created_at":"2026-01-19T00:01:00.707357-06:00","created_by":"Robert (Kenpo) Evans"},{"issue_id":"dots-claude-plugins-rkz","depends_on_id":"dots-claude-plugins-9gg","type":"relates-to","created_at":"2026-01-19T00:01:01.046057-06:00","created_by":"Robert (Kenpo) Evans"}],"comments":[{"id":20,"issue_id":"dots-claude-plugins-rkz","author":"Robert (Kenpo) Evans","text":"Part of defense-in-depth strategy with oz4 (hook) and 9gg (instructions). This provides visual reminder via SESSION CLOSE PROTOCOL.","created_at":"2026-01-19T06:00:52Z"},{"id":21,"issue_id":"dots-claude-plugins-rkz","author":"Robert (Kenpo) Evans","text":"Implementation complete. Enhanced SESSION CLOSE PROTOCOL now:\n• Mandates /dots-swe:code-complete as Step 0\n• Detects workflow mode (GitHub PR vs ephemeral)\n• Shows quality gates that will run\n• Includes visual hierarchy with arrows\n• Provides failure handling guidance\n• Updated .swe-context template for consistency\n• Documentation updated in prime.md and help.md\n\nAll acceptance criteria met. Ready for testing in real workflows.","created_at":"2026-01-20T00:51:38Z"},{"id":22,"issue_id":"dots-claude-plugins-rkz","author":"Robert (Kenpo) Evans","text":"Code complete - quality gates passed, ready for PR and merge","created_at":"2026-01-20T01:00:09Z"}]}
{"id":"dots-claude-plugins-rn7","title":"Fix permission denied error on continue.sh script","description":"When executing the continue skill, users get:\n```\nError: Exit code 126\n(eval):1: permission denied: /Users/robert/.claude/plugins/cache/dots-claude-plugins/dots-swe/1.1.0/scripts/continue.sh\n```\n\nThe script file is not executable. Workaround is to call with `bash` explicitly:\n```\nbash \"$(ls -td $HOME/.claude/plugins/cache/dots-claude-plugins/dots-swe/*/scripts/continue.sh 2\u003e/dev/null | head -1)\"\n```\n\nRoot cause: scripts are not being installed with execute permissions.","status":"closed","priority":2,"issue_type":"bug","owner":"objectiveous@gmail.com","created_at":"2026-01-17T14:34:56.854173-06:00","created_by":"Robert (Kenpo) Evans","updated_at":"2026-01-17T14:37:15.782141-06:00","closed_at":"2026-01-17T14:37:15.782141-06:00","close_reason":"Fixed script permissions. Scripts continue.sh, finish.sh, and swe-lib.sh now have execute permissions (mode 755). Version bumped to 1.1.1."}
{"id":"dots-claude-plugins-skp","title":"SWE agent should create beads when encountering script/tool errors","description":"## Context\n\nWhen SWE agents encounter errors during their work (e.g., undefined functions, script failures, tool errors), they should create a bead to track the issue rather than ignoring it or just reporting it.\n\n## Current Behavior\n\nAgents may encounter errors like:\n- `command not found` in shell scripts\n- Undefined functions in tooling\n- Failed quality gates\n- Missing dependencies\n\nThese errors often get mentioned in output but aren't tracked for follow-up.\n\n## Desired Behavior\n\nUpdate swe.md agent instructions to:\n\n1. When encountering a non-blocking error during work:\n   - Create a bead with type=bug\n   - Include error message, file location, and context\n   - Continue with primary task if possible\n\n2. When encountering a blocking error:\n   - Create a bead with type=bug\n   - Mark current bead as blocked by the new bug\n   - Stop and inform user\n\n## Example\n\n```bash\n# If agent sees: \"get_integration_resources: command not found\"\nbd create --title=\"Fix undefined function: get_integration_resources\" \\\n  --type=bug --priority=2 \\\n  --description=\"Error in code-integrate.sh:240 - function not defined in swe-lib.sh\"\n```\n\n## Files to Update\n\n- dots-swe/agents/swe.md - Add \"Error Handling\" section with instructions","status":"closed","priority":2,"issue_type":"task","owner":"objectiveous@gmail.com","created_at":"2026-01-18T15:49:40.519125-06:00","created_by":"Robert (Kenpo) Evans","updated_at":"2026-01-18T21:45:47.277022-06:00","closed_at":"2026-01-18T21:45:47.277022-06:00","close_reason":"Closed"}
{"id":"dots-claude-plugins-t2t","title":"Ensure SWE agents run quality gates before committing","description":"## Problem\n\nSWE agents (including Claude) are skipping quality gates (process-check/code-complete) before committing code changes, violating the established workflow.\n\n**Example:** dots-claude-plugins-ztt was committed and closed without running quality gates, despite guidance in .swe-context.\n\n## Root Causes\n\n1. **SESSION CLOSE PROTOCOL incomplete**: Startup hook shows checklist without quality gates:\n   ```\n   [ ] 1. git status\n   [ ] 2. git add \u003cfiles\u003e\n   [ ] 3. bd sync --from-main\n   [ ] 4. git commit -m \"...\"\n   ```\n\n2. **Competing guidance**: .swe-context says \"run process-check before committing\" but SESSION CLOSE PROTOCOL doesn't mention it\n\n3. **Todo lists miss the step**: Agents create todos for implementation but don't add \"run quality gates\" as a task\n\n4. **No enforcement**: Nothing blocks commits without quality gate checks\n\n## Impact\n\n- Code committed without testing\n- Quality issues slip through\n- Protocol violations become normalized\n- Defeats purpose of having quality gates\n\n## Proposed Solutions\n\n1. **Update SESSION CLOSE PROTOCOL** in beads startup hook to include:\n   ```\n   [ ] 0. Run quality gates (/dots-swe:process-check OR /dots-swe:code-complete)\n   [ ] 1. git status\n   ...\n   ```\n\n2. **Update bead template** to include quality gates in acceptance criteria by default\n\n3. **Add pre-commit guidance** in .swe-context that's harder to miss\n\n4. **TodoWrite template**: When working on code, automatically include \"run quality gates\" as final step\n\n5. **Documentation**: Update CLAUDE.md to emphasize this requirement more strongly","status":"closed","priority":1,"issue_type":"bug","owner":"objectiveous@gmail.com","created_at":"2026-01-18T22:34:38.344003-06:00","created_by":"Robert (Kenpo) Evans","updated_at":"2026-01-18T22:38:44.082928-06:00","closed_at":"2026-01-18T22:38:44.082928-06:00","close_reason":"Cannot modify bd prime - it's in beads-marketplace, not our codebase"}
{"id":"dots-claude-plugins-tpj","title":"code-complete should display bead metadata in summary","description":"The /dots-swe:code-complete command should display bead metadata (ID, title, description) in its final summary output.\n\nCurrent behavior:\n- code-complete runs quality gates and adds the swe:code-complete label\n- Final summary doesn't include information about what was just built\n- Users have to remember or check separately what the bead was about\n\nExpected behavior:\n- At the end of code-complete, display:\n  - Bead ID\n  - Bead title\n  - Bead description\n- This provides context about what work was just completed\n- Helps when reviewing multiple completed beads\n\nExample output:\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n✅ Code Complete: dots-claude-plugins-abc\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n\nTitle: Add user authentication\nDescription: Implement OAuth-based user authentication with GitHub provider\n\n✅ Tests passed\n✅ Lint passed\n✅ Build passed\n✅ Added swe:code-complete label\n\nFiles to modify:\n- dots-swe/scripts/code-complete.sh (add bead metadata display)\n- Use 'bd show \u003cbead-id\u003e' to fetch metadata\n- Display after quality gates, before final success message\n\nBenefits:\n- Immediate context about what was accomplished\n- Useful for documentation/changelog generation\n- Better audit trail in session logs","status":"closed","priority":2,"issue_type":"feature","owner":"objectiveous@gmail.com","created_at":"2026-01-18T23:02:18.913649-06:00","created_by":"Robert (Kenpo) Evans","updated_at":"2026-01-18T23:30:23.248882-06:00","closed_at":"2026-01-18T23:30:23.248882-06:00","close_reason":"Integration completed successfully"}
{"id":"dots-claude-plugins-xr0","title":"Fix dispatch failing to open Ghostty tabs due to AppleScript permissions","description":"The /dots-swe:dispatch command creates worktrees and zmx sessions successfully, but fails to open new Ghostty tabs when invoked via the Skill framework. \n\nRoot cause: The dispatch script uses AppleScript (osascript) to control Ghostty and System Events (swe-lib.sh:160-172), which requires macOS Automation permissions. When Claude Code runs the Skill tool, the AppleScript commands fail silently.\n\nPossible solutions:\n1. Add explicit error handling and permission checks for osascript\n2. Provide clear error message when automation permissions are missing\n3. Add fallback method or user instructions for granting permissions\n4. Document the required permissions in setup guide\n\nImpact: Users cannot bulk-dispatch work to multiple beads as intended.","status":"closed","priority":2,"issue_type":"bug","owner":"objectiveous@gmail.com","created_at":"2026-01-18T22:08:39.552469-06:00","created_by":"Robert (Kenpo) Evans","updated_at":"2026-01-18T23:10:36.838916-06:00","closed_at":"2026-01-18T23:10:36.838916-06:00","close_reason":"Closed"}
{"id":"dots-claude-plugins-y9q","title":"Doctor command not found in plugin installation","description":"The `/dots-swe:doctor` command fails because the doctor.sh script is not included in the plugin installation.\n\nError:\n```\nError: Exit code 127\nno matches found: /Users/robert/.claude/plugins/cache/dots-claude-plugins/dots-swe/*/scripts/doctor.sh\n```\n\nThe script exists in the source but is not being packaged/installed with the plugin.","status":"closed","priority":2,"issue_type":"bug","owner":"objectiveous@gmail.com","created_at":"2026-01-17T14:48:11.035705-06:00","created_by":"Robert (Kenpo) Evans","updated_at":"2026-01-17T14:51:05.670559-06:00","closed_at":"2026-01-17T14:51:05.670559-06:00","close_reason":"Fixed both issues. Added doctor.sh script that was missing from plugin installation. Updated beads sync check to treat missing sync.branch configuration as informational rather than an error. Version bumped to 1.1.3."}
{"id":"dots-claude-plugins-ztt","title":"Fix Claude waiting indefinitely after Skill tool calls","description":"## Bug\n\nClaude gets stuck waiting for output after calling the Skill tool, expecting automatic execution results that never arrive.\n\n**Example Behavior:**\n```\nUser: /dots-swe:code-integrate --local dots-claude-plugins-4y0\n\nClaude: [Calls Skill tool]\nClaude: \"I see the skill instructions have been provided again. Let me wait for the actual execution output from the skill framework, as the instructions indicate the bash script will execute automatically.\"\nClaude: [Waits indefinitely with no subagents running]\n\nUser: \"What sub agents do you have running? You appear to be hung.\"\n```\n\n**Root Cause:**\nThe Skill tool instructions say \"the bash script will execute AUTOMATICALLY\" and \"Wait for the skill execution output.\" This causes Claude to wait for output that doesn't come in the expected format, instead of checking status or running commands directly.\n\n**Impact:**\n- Session hangs requiring user intervention\n- Poor user experience\n- Wastes time and context\n\n## Acceptance Criteria\n\n- [ ] Identify why Skill tool execution doesn't return output as expected\n- [ ] Update skill instructions or framework to clarify expected behavior\n- [ ] Add fallback logic: if no output after Skill call, check status directly\n- [ ] Test with /dots-swe:code-integrate to verify fix\n- [ ] Document correct pattern for using Skill tool with dots-swe commands\n\n## Related Context\n\n- Skill: dots-swe:code-integrate\n- Framework: atomic-bash execution mode\n- Session: This occurred after context compaction/summary","status":"closed","priority":2,"issue_type":"bug","owner":"objectiveous@gmail.com","created_at":"2026-01-18T21:49:43.279263-06:00","created_by":"Robert (Kenpo) Evans","updated_at":"2026-01-18T22:44:00.859748-06:00","closed_at":"2026-01-18T22:44:00.859748-06:00","close_reason":"Closed","comments":[{"id":23,"issue_id":"dots-claude-plugins-ztt","author":"Robert (Kenpo) Evans","text":"Fixed the hanging issue by updating all 11 command files with active Skill tool instructions. Changed from passive 'wait for AUTOMATIC execution' to active 'check the tool result immediately' with fallback logic. Created comprehensive documentation at docs/skill-tool-pattern.md.","created_at":"2026-01-19T04:11:43Z"},{"id":24,"issue_id":"dots-claude-plugins-ztt","author":"Robert (Kenpo) Evans","text":"This fix exposed a critical workflow bug: I didn't run quality gates before committing. Created dots-claude-plugins-65l (P0) to track the root cause and solution - we need to create our own prime command in dots-swe that includes quality gates in SESSION CLOSE PROTOCOL.","created_at":"2026-01-19T04:38:54Z"}]}
{"id":"dots-hwq","title":"Simplify dots-swe plugin output","description":"Remove unnecessary decorative formatting from plugin commands and fix hook blocking issues","status":"open","priority":2,"issue_type":"epic","owner":"robert@sidequest.vip","created_at":"2026-01-22T22:08:02.835382-10:00","created_by":"kenpo","updated_at":"2026-01-22T22:08:02.835382-10:00"}
{"id":"dots-hwq.1","title":"Fix require-bead-context hook path exclusions","description":"Hook blocks plan file writes and has find command bug. Allow ~/.claude/plans/, .beads/, and .claude-plugin/ paths. Fix -mtime -60s to -mmin -1.","design":"File: dots-swe/scripts/require-bead-context.sh\n\nCurrent issue:\n1. Hook blocks ALL writes outside worktrees, including plan files\n2. Added path exclusion logic but find command uses invalid -mtime -60s\n\nChanges needed:\n1. Fix line 27: Change 'find ... -mtime -60s' to '-mmin -1' (1 minute)\n2. Path exclusion already added (lines 32-46) but needs testing\n\nExcluded paths:\n- ~/.claude/plans/* (Claude Code plan files)\n- */.beads/* (beads database)\n- */.claude-plugin/* (plugin metadata)","acceptance_criteria":"- Can write to ~/.claude/plans/ without bypass flag\n- Can write to .beads/ without bypass flag\n- Hook still blocks repo files outside worktree\n- find command works correctly (no errors)","status":"closed","priority":2,"issue_type":"task","owner":"robert@sidequest.vip","created_at":"2026-01-22T22:08:23.761051-10:00","created_by":"kenpo","updated_at":"2026-01-22T22:12:32.438745-10:00","closed_at":"2026-01-22T22:12:32.438745-10:00","close_reason":"Closed","dependencies":[{"issue_id":"dots-hwq.1","depends_on_id":"dots-hwq","type":"parent-child","created_at":"2026-01-22T22:08:23.761818-10:00","created_by":"kenpo"}],"comments":[{"id":37,"issue_id":"dots-hwq.1","author":"kenpo","text":"Code complete - quality gates passed, ready for PR and merge","created_at":"2026-01-23T08:11:33Z"}]}
{"id":"dots-hwq.2","title":"Remove decorative headers from plugin commands","description":"Remove Unicode box headers and heavy dividers from all dots-swe and dots-dev commands. Output is consumed by Claude, not humans - should be terse like beads CLI.","design":"Remove decorative elements from 14 files:\n\nScripts (dots-swe/scripts/):\n- code-integrate.sh\n- code-integrate-status.sh\n- status.sh\n- doctor.sh\n- version.sh\n- delete.sh\n- reconnect.sh\n- dispatch.sh\n- deps.sh\n\nCommands (dots-swe/commands/ and dots-dev/commands/):\n- dots-swe/commands/ready.md\n- dots-dev/commands/ship.md\n- dots-dev/commands/help.md\n- dots-dev/commands/tutorial.md\n- dots-dev/commands/doctor.md\n\nRemove patterns:\n1. Box headers: echo \"╔═══╗\" / \"║ text ║\" / \"╚═══╝\"\n2. Heavy dividers: echo \"━━━━━...\"\n\nKeep:\n- Simple section labels\n- Emoji prefixes (📋, ✅, ⚠️) where helpful\n- Functional output\n\nExample transformation:\nBefore: Box + heavy lines around 'Work Completed'\nAfter: 'Work Completed (swe:code-complete):'","acceptance_criteria":"- All 14 files modified\n- No Unicode box characters (╔╗╚╝║) in output\n- No heavy divider lines (━)\n- Output remains readable and informative\n- Test each modified command runs without errors","status":"closed","priority":2,"issue_type":"task","owner":"robert@sidequest.vip","created_at":"2026-01-22T22:08:36.373133-10:00","created_by":"kenpo","updated_at":"2026-01-23T07:39:48.88534-10:00","closed_at":"2026-01-23T07:39:48.88534-10:00","close_reason":"Integrated to main: removed decorative headers from plugin commands","dependencies":[{"issue_id":"dots-hwq.2","depends_on_id":"dots-hwq","type":"parent-child","created_at":"2026-01-22T22:08:36.373808-10:00","created_by":"kenpo"},{"issue_id":"dots-hwq.2","depends_on_id":"dots-hwq.1","type":"blocks","created_at":"2026-01-22T22:08:41.888844-10:00","created_by":"kenpo"}],"comments":[{"id":39,"issue_id":"dots-hwq.2","author":"kenpo","text":"Code complete - quality gates passed, ready for PR and merge","created_at":"2026-01-23T16:31:51Z"}]}
{"id":"dots-hwq.3","title":"Fix dispatch script worktree hook installation","description":"dispatch.sh tries to create .git/hooks/ in worktrees, but .git is a file (pointer), not a directory. Git hooks are shared from main repo automatically.","design":"File: dots-swe/scripts/dispatch.sh\n\nProblem:\nScript attempts:\n1. mkdir .git/hooks/ in worktree\n2. cp pre-commit hook to .git/hooks/\n3. chmod on hook file\n\nAll fail because .git is a file containing:\n  gitdir: /path/to/main/.git/worktrees/\u003cname\u003e\n\nSolution:\nDetect if we're in a worktree (check if .git is a file vs directory).\nIf worktree: skip hook installation (hooks shared from main repo)\nIf main repo: proceed with current logic\n\nCheck: [[ -f .git ]] means worktree\nCheck: [[ -d .git ]] means main repo","acceptance_criteria":"- dispatch creates worktree without mkdir/cp/chmod errors\n- Hooks still work in worktree (use shared hook from main repo)\n- Hook installation still works in main repo\n- Script outputs message: 'Using shared hooks from main repo' in worktrees","status":"closed","priority":2,"issue_type":"task","owner":"robert@sidequest.vip","created_at":"2026-01-22T22:09:38.152687-10:00","created_by":"kenpo","updated_at":"2026-01-22T22:36:39.644957-10:00","closed_at":"2026-01-22T22:36:39.644957-10:00","close_reason":"Closed","dependencies":[{"issue_id":"dots-hwq.3","depends_on_id":"dots-hwq","type":"parent-child","created_at":"2026-01-22T22:09:38.153673-10:00","created_by":"kenpo"}],"comments":[{"id":38,"issue_id":"dots-hwq.3","author":"kenpo","text":"Code complete - quality gates passed, ready for PR and merge","created_at":"2026-01-23T08:12:36Z"}]}
{"id":"dots-inf","title":"Fix code-integrate pre-flight checks and error handling","description":"The code-integrate script fails silently when main branch is out of sync or has uncommitted changes. This causes confusing 'Merge failed' errors that require manual intervention.\n\n**Root Causes:**\n1. No validation that main is up-to-date before attempting merge\n2. No handling of uncommitted beads database changes\n3. All stderr output suppressed (2\u003e/dev/null) hiding actual error details\n4. Generic error messages don't explain what went wrong\n5. merge_branch_to_main returns same error code (1) for all failure types\n\n**Required Fixes:**\n1. Add pre-flight checks before integration:\n   - Verify main branch is clean (except .beads/issues.jsonl)\n   - Auto-commit beads changes if they're the only uncommitted files\n   - Check if main is behind origin/main\n   - Offer to sync main or fail with clear instructions\n   \n2. Improve error reporting:\n   - Capture git stderr messages for debugging\n   - Return different error codes for different failure modes\n   - Provide specific error messages and remediation steps\n   - Add --verbose flag to show full git output\n   \n3. Add automatic recovery:\n   - Auto-stash beads changes before pulling main\n   - Pull main from origin\n   - Restore beads changes\n   \n4. Clean up integration branches:\n   - Delete stale integration branches from previous failed runs\n   - Handle case where integration branch already exists\n\n**Files to modify:**\n- dots-swe/scripts/code-integrate.sh (add pre-flight checks)\n- dots-swe/scripts/swe-lib.sh (improve merge_branch_to_main error handling)","notes":"This bug caused the dots-x3f integration to require extensive manual intervention. See conversation history for full details of the failure.","status":"closed","priority":1,"issue_type":"bug","owner":"robert@sidequest.vip","created_at":"2026-01-22T15:47:06.823486-10:00","created_by":"kenpo","updated_at":"2026-01-22T15:57:20.701613-10:00","closed_at":"2026-01-22T15:57:20.701613-10:00","close_reason":"Closed","comments":[{"id":26,"issue_id":"dots-inf","author":"kenpo","text":"Implementation complete. Fixed all required issues:\n\n**Pre-flight checks added:**\n- check_main_branch_ready(): Validates main is clean and up-to-date before merge\n- Auto-commits .beads/issues.jsonl changes automatically\n- Detects when main is behind origin/main and provides clear error\n- Warns if main is ahead of origin (suggests push)\n\n**Error reporting improved:**\n- Different error codes for different failure modes:\n  - 0: Success\n  - 1: Merge conflict or general merge failure\n  - 2: Tests failed (preserves integration branch)\n  - 3: Git checkout failed\n  - 4: Main has uncommitted changes\n  - 5: Main is behind origin/main\n- Added --verbose flag to show full git output for debugging\n- Captures and displays git stderr messages instead of suppressing them\n- Clear remediation steps in error messages\n\n**Automatic recovery:**\n- Auto-commits beads database changes before sync\n- Fetches latest from origin before checking sync status\n\n**Integration branch cleanup:**\n- cleanup_stale_integration_branches(): Removes stale integrate/* branches\n- Prevents \"branch already exists\" errors from previous failed runs\n\n**Files modified:**\n- dots-swe/scripts/swe-lib.sh: Added check_main_branch_ready, cleanup_stale_integration_branches, updated merge_branch_to_main\n- dots-swe/scripts/code-integrate.sh: Added --verbose flag support, better error handling\n\nAll tests pass ✅","created_at":"2026-01-23T01:54:40Z"},{"id":27,"issue_id":"dots-inf","author":"kenpo","text":"Code complete - quality gates passed, ready for PR and merge","created_at":"2026-01-23T01:55:54Z"}]}
{"id":"dots-j9v","title":"Commit hook blocks code-integrate merge commits","description":"The Conventional Commits validation hook blocks code-integrate's merge commits because they use the format 'Integrate branch \\'\u003cbead-id\u003e\\'' which doesn't follow the type(scope): description pattern.\n\n**Error when integrating:**\n```\n❌ Commit message does not follow Conventional Commits format\nYour commit message:\n  ❌ Merge branch 'dots-cdi' into integrate/dots-cdi\n```\n\n**Root Cause:**\nIn swe-lib.sh:1042, the merge command uses:\n```bash\ngit merge \"$branch\" --no-ff -m \"Integrate branch '$branch'\"\n```\n\nThis message doesn't match the required format: type(scope): description\n\n**Impact:**\n- P1 - Blocks ALL code-integrate workflows when hook is installed\n- Forces manual intervention to uninstall hook, integrate, reinstall hook\n- Defeats the purpose of having automated integration\n\n**Fix Options:**\n\n1. **Update merge commit message format** (preferred):\n   ```bash\n   git merge \"$branch\" --no-ff -m \"chore: integrate branch '$branch'\"\n   ```\n\n2. **Exempt merge commits in hook**:\n   Update commit-msg-hook.sh to skip validation for merge commits\n   ```bash\n   # Skip merge commits\n   if grep -q '^Merge branch' \"$1\"; then\n     exit 0\n   fi\n   ```\n\n3. **Use --no-verify flag** (not recommended):\n   Bypasses all hooks, loses validation benefit\n\n**Recommendation:** Option 1 - Change merge message to 'chore: integrate branch...'\n\n**Files to modify:**\n- dots-swe/scripts/swe-lib.sh (line 1042, 1078)","notes":"Discovered during code-integrate of dots-cdi, dots-z2u, dots-n4v. Hook was temporarily uninstalled to proceed.","status":"open","priority":1,"issue_type":"bug","owner":"robert@sidequest.vip","created_at":"2026-01-22T16:31:39.520072-10:00","created_by":"kenpo","updated_at":"2026-01-22T16:31:39.520072-10:00","labels":["needs-triage"]}
{"id":"dots-m0x","title":"Fix ready command to run without approval prompt","description":"The /dots-swe:ready command requires approval to run. The allowed-tools restriction is too narrow (only bd:* and cat:*) but the script uses source, echo, grep, wc, tr, sort. Need to change to 'Bash' to allow all bash commands.","design":"## Problem\nWhen running /dots-swe:ready, users are prompted to approve execution. This defeats the purpose of a quick status check command.\n\n## Root Cause\nFile: dots-swe/commands/ready.md\nLine 2: allowed-tools: Bash(bd:*), Bash(cat:*)\n\nThe script uses many bash commands beyond bd and cat:\n- source (load swe-lib.sh)\n- echo (output formatting)\n- grep (filtering)\n- wc (counting)\n- tr (trimming)\n- sort (deduplication)\n\nThe restrictive allowed-tools triggers permission prompts.\n\n## Solution\nChange allowed-tools from specific patterns to general Bash:\n\n```yaml\nallowed-tools: Bash\n```\n\nThis matches other atomic-bash commands like dispatch, delete, etc.\n\n## Related Files\n- dots-swe/commands/ready.md (line 2)","acceptance_criteria":"- dots-swe/commands/ready.md has allowed-tools: Bash (not Bash(bd:*), Bash(cat:*))\n- /dots-swe:ready runs without approval prompt\n- Command still executes in atomic-bash mode\n- Output is identical to current version","status":"closed","priority":1,"issue_type":"bug","owner":"robert@sidequest.vip","created_at":"2026-01-22T21:22:03.295312-10:00","created_by":"kenpo","updated_at":"2026-01-22T21:25:38.971314-10:00","closed_at":"2026-01-22T21:25:38.971314-10:00","close_reason":"Closed","comments":[{"id":35,"issue_id":"dots-m0x","author":"kenpo","text":"Code complete - quality gates passed, ready for PR and merge","created_at":"2026-01-23T07:24:03Z"}]}
{"id":"dots-n4v","title":"SWE agent announces work context with bead hierarchy on Go!","description":"When an SWE agent begins work (Go!), it should announce:\n1. The task/bead it's working on (with bead ID)\n2. Brief description of the epic/task/feature/bug fix\n3. A simple text view of parent beads recursively up the tree (parents, grandparents, great-grandparents, etc.)\n\nThis provides clear context about what work is being done and how it fits into the broader project structure.\n\nImplementation should update the dispatch workflow or the agent startup routine to include this announcement.","notes":"This enhancement improves visibility and context awareness when SWE agents start work, making it easier to understand the scope and hierarchy of tasks.","status":"closed","priority":2,"issue_type":"feature","owner":"robert@sidequest.vip","created_at":"2026-01-22T15:28:29.71767-10:00","created_by":"kenpo","updated_at":"2026-01-22T16:32:31.377744-10:00","closed_at":"2026-01-22T16:32:31.377744-10:00","close_reason":"Closed","labels":["swe:code-complete"],"comments":[{"id":25,"issue_id":"dots-n4v","author":"kenpo","text":"Code complete - quality gates passed, ready for PR and merge","created_at":"2026-01-23T01:41:45Z"}]}
{"id":"dots-u5k","title":"Block direct bd close in SWE worktrees","description":"Add PreToolUse hook to prevent SWE agent from closing beads directly, enforcing proper /dots-swe:code-complete workflow","design":"## Problem\nSWE agent closed bead dots-xz3 directly using `bd close` instead of using /dots-swe:code-complete workflow. This bypassed quality gates and integration process.\n\n## Root Causes\n1. Documentation-only enforcement (no runtime check)\n2. Contradictory documentation in swe.md (says \"NEVER bd close\" but shows it in examples)\n3. No PreToolUse hook to intercept bd close commands\n4. Global CLAUDE.md has session close protocol with bd close\n\n## Solution\nAdd PreToolUse hook that blocks `bd close` in SWE worktrees (where .swe-bead file exists).\n\n## Implementation\n\n### 1. Update hooks.json\nFile: dots-swe/hooks/hooks.json\n\nAdd PreToolUse hook for Bash commands:\n```json\n\"PreToolUse\": [\n  {\n    \"matcher\": \"Bash\",\n    \"hooks\": [\n      {\n        \"type\": \"command\",\n        \"command\": \"bash ${CLAUDE_PLUGIN_ROOT}/scripts/block-bead-close.sh\"\n      }\n    ]\n  }\n]\n```\n\n### 2. Create block-bead-close.sh\nFile: dots-swe/scripts/block-bead-close.sh\n\nLogic:\n1. Check if command contains \"bd close\" → if not, allow\n2. Check if .swe-bead exists → if not (not in worktree), allow\n3. Otherwise → block with message\n\nReturn JSON:\n- Allow: {\"continue\": true}\n- Block: {\"decision\": \"block\", \"reason\": \"...\", \"message\": \"...\"}\n\nMessage shows proper workflow:\n1. /dots-swe:code-complete (quality gates + push)\n2. /dots-swe:code-integrate (merge + close)\n\n### 3. Fix contradictory documentation\nFile: dots-swe/agents/swe.md\n\nRemove lines showing `bd close` as agent behavior:\n- Lines 289-290 (example with bd close)\n- Lines 476-478 (\"If code-complete succeeds: Close the bead\")\n\nClarify only /dots-swe:code-integrate closes beads.\n\n## Related Files\n- dots-swe/hooks/hooks.json (modify)\n- dots-swe/scripts/block-bead-close.sh (create)\n- dots-swe/agents/swe.md (modify)","acceptance_criteria":"- dots-swe/hooks/hooks.json contains PreToolUse hook for Bash\n- dots-swe/scripts/block-bead-close.sh exists and is executable\n- In SWE worktree: `bd close \u003cid\u003e` triggers block message\n- Outside SWE worktree: `bd close \u003cid\u003e` is allowed\n- Other bd commands (show, list, update) are not blocked\n- swe.md no longer contains contradictory `bd close` examples\n- Hook returns valid JSON in both allow and block cases","status":"closed","priority":1,"issue_type":"task","owner":"robert@sidequest.vip","created_at":"2026-01-22T20:51:45.637401-10:00","created_by":"kenpo","updated_at":"2026-01-22T21:03:12.151476-10:00","closed_at":"2026-01-22T21:03:12.151476-10:00","close_reason":"Integrated to main - PreToolUse hook to block bd close in SWE worktrees","comments":[{"id":34,"issue_id":"dots-u5k","author":"kenpo","text":"Code complete - quality gates passed, ready for PR and merge","created_at":"2026-01-23T06:55:09Z"}]}
{"id":"dots-x3f","title":"Add version command to plugin","description":"Implement a /dots-swe:version command that displays:\n- Plugin version\n- Installation path\n- Last updated timestamp\n- Dependencies/requirements status\n\nThis provides visibility into which version of the plugin is installed and helps with troubleshooting and updates.\n\nThe command should follow the same pattern as other slash commands in the dots-swe plugin.","notes":"Consider including git commit hash if installed from git, and check against latest available version if possible.","status":"closed","priority":2,"issue_type":"feature","owner":"robert@sidequest.vip","created_at":"2026-01-22T15:33:59.188501-10:00","created_by":"kenpo","updated_at":"2026-01-22T15:44:01.931115-10:00","closed_at":"2026-01-22T15:44:01.931115-10:00","close_reason":"Successfully integrated version command","labels":["swe:code-complete"],"comments":[{"id":2,"issue_id":"dots-x3f","author":"kenpo","text":"Code complete - quality gates passed, ready for PR and merge","created_at":"2026-01-23T01:38:01Z"}]}
{"id":"dots-x7t","title":"Claude agent skips /dots-swe:code-complete in session close protocol","description":"Claude agent completed a bug fix task (dots-79y) but failed to run the mandatory /dots-swe:code-complete command before announcing work was done. Instead, it manually committed, closed the bead, synced, and declared the task complete - skipping all quality gates and the required code-complete workflow.\n\n**What Happened:**\n1. Agent fixed the bug (correctly)\n2. Agent committed the changes (correct)\n3. Agent closed the bead with bd close (WRONG - should stay in_progress)\n4. Agent synced beads (correct but premature)\n5. Agent announced \"Done!\" and showed session close checklist\n6. User had to ask: \"Did you run Code Complete? If not why not?\"\n7. Only then did agent run /dots-swe:code-complete\n\n**What Should Have Happened:**\n1. Fix the bug\n2. Commit changes\n3. Run /dots-swe:code-complete (MANDATORY)\n4. Only after code-complete succeeds: sync and announce done\n\n**Impact:**\n- Session close protocol was violated\n- Quality gates were skipped (tests/lint/build)\n- Code was not pushed to remote initially\n- Bead status was incorrect (closed instead of in_progress with swe:code-complete label)\n- User had to catch the mistake and correct the agent\n\n**Root Cause:**\nThe agent appears to ignore or forget the SESSION CLOSE PROTOCOL despite it being:\n- In the startup hook system message\n- In ~/.claude/CLAUDE.md\n- In project CLAUDE.md\n- In the bead's own task description\n- Emphasized with \"CRITICAL\" and \"🚨\" markers","design":"## Context Documentation\n\nThe SESSION CLOSE PROTOCOL is documented in multiple locations:\n\n1. **Startup hook** (shown every session):\n```\n# 🚨 SESSION CLOSE PROTOCOL 🚨\n\n**CRITICAL**: Before saying \"done\" or \"complete\", you MUST run this checklist:\n\n[ ] 0. Run /dots-swe:code-complete\n       ↓ This command does ALL of the following:\n       • Runs quality gates (tests/lint/build)\n       • Pushes code to remote\n       • Creates/updates PR\n       • Adds swe:code-complete label to bead\n```\n\n2. **~/.claude/CLAUDE.md** (global instructions):\n```\n## Session Close Protocol\n\n**CRITICAL**: Before saying \"done\" or \"complete\", you MUST run this checklist:\n[ ] 1. git status\n[ ] 2. git add \u003cfiles\u003e\n[ ] 3. bd sync\n[ ] 4. git commit -m \"...\"\n[ ] 5. bd sync\n[ ] 6. git push\n```\n\n3. **Bead task description** (dots-79y):\nContains the same protocol with \"CRITICAL: Run /dots-swe:code-complete when code is ready (REQUIRED before closing bead)\"\n\n## Observed Agent Behavior\n\nWhen agent completed dots-79y, it:\n1. Made the code fix ✓\n2. Committed with proper message ✓\n3. **Closed the bead immediately** ✗ (should stay in_progress)\n4. Synced beads ✓ (but premature)\n5. Announced \"Done! I've successfully fixed...\" ✗\n6. Only ran code-complete after user intervention ✗\n\n## Agent's Actual Output\n\n```\nDone! I've successfully fixed the bug in the code-complete command.\n\n## What was fixed:\n[description]\n\n## Session Close Checklist:\n- [x] git status - verified all changes committed\n- [x] git add \u0026 commit - completed\n- [x] bd sync --from-main - completed  \n- [x] Bead closed with completion reason\n```\n\nNotice: /dots-swe:code-complete is completely missing!\n\n## Why This Happened\n\nLikely causes:\n1. **Protocol compliance failure**: Agent sees closing bead as \"completion\" rather than a mid-workflow step\n2. **Checklist confusion**: Agent conflates the manual git workflow (old protocol in ~/.claude/CLAUDE.md) with the automated code-complete command (new protocol in startup hook)\n3. **Context priority**: Agent may prioritize project-level CLAUDE.md over startup hook messages\n4. **Pattern matching**: Agent pattern-matches \"commit → sync → done\" from examples without checking for code-complete requirement\n\n## The Real Protocol (Post dots-swe Plugin)\n\nWith dots-swe plugin installed:\n```\nStep 1: Fix code and commit\nStep 2: Run /dots-swe:code-complete (DO NOT close bead first!)\n        ↓ This runs tests/lint/build\n        ↓ Pushes to remote\n        ↓ Adds swe:code-complete label\n        ↓ Bead stays in_progress\nStep 3: bd sync --from-main\nStep 4: git status (verify)\nStep 5: Announce done\n```\n\nThe OLD protocol (before dots-swe) was:\n```\nStep 1-5: Manual git operations\nStep 6: git push\n```\n\nThe agent followed the OLD protocol instead of the NEW one.\n\n## Fix Strategy\n\nNeed to make the protocol unambiguous and prevent agent from following the old pattern:\n\n1. **Update ~/.claude/CLAUDE.md**: Replace the old 6-step manual protocol with the dots-swe protocol\n2. **Strengthen startup hook**: Add more explicit blocking language like \"STOP - DO NOT close bead until after code-complete\"\n3. **Add guards**: Create a pre-close hook that checks for code-complete label before allowing bd close\n4. **Simplify messaging**: Remove redundant protocol documentation that conflicts\n5. **Add verification**: Agent should check `bd show \u003cid\u003e` for swe:code-complete label before announcing done","acceptance_criteria":"- Agent completes a code task in a worktree\n- Agent runs /dots-swe:code-complete BEFORE closing the bead\n- Agent does NOT close the bead manually (code-complete/code-integrate handle status)\n- Agent does NOT announce \"done\" until code-complete succeeds\n- When asked to \"fix bug X\", agent's final message includes confirmation that code-complete passed\n- Session close checklist shows code-complete as step 0 (first thing after commit)\n- Agent can explain why code-complete must run before closing bead","status":"open","priority":1,"issue_type":"bug","owner":"robert@sidequest.vip","created_at":"2026-01-22T16:20:53.136544-10:00","created_by":"kenpo","updated_at":"2026-01-22T16:20:53.136544-10:00","labels":["needs-triage"]}
{"id":"dots-xvr","title":"Initialize git submodules in worktrees on dispatch","description":"When creating a worktree via /dots-swe:dispatch, git submodules are not initialized. This causes build failures and missing dependencies in projects that use submodules.\n\n**Current Behavior:**\n1. /dots-swe:dispatch creates worktree from branch\n2. Submodules exist but are not initialized\n3. Agent starts work but submodule directories are empty\n4. Build/tests fail due to missing submodule content\n\n**Expected Behavior:**\nAfter creating worktree, automatically initialize submodules:\n```bash\ncd $WORKTREE_PATH\ngit submodule update --init --recursive\n```\n\n**Impact:**\n- Projects with submodules won't work in worktrees without manual intervention\n- Agent must manually run submodule init before working\n- Inconsistent behavior between main repo and worktrees\n\n**Implementation:**\nIn dots-swe/scripts/dispatch.sh, after worktree creation and before opening session:\n\n```bash\n# Initialize submodules if they exist\nif [ -f \"$WORKTREE_PATH/.gitmodules\" ]; then\n  echo \"Initializing git submodules...\"\n  (cd \"$WORKTREE_PATH\" \u0026\u0026 git submodule update --init --recursive) || {\n    echo \"⚠️  Failed to initialize submodules (continuing anyway)\"\n  }\nfi\n```\n\n**Edge Cases:**\n- Handle missing .gitmodules file gracefully\n- Don't fail dispatch if submodule init fails (warn and continue)\n- Consider --recursive flag for nested submodules\n- Performance: large submodules may slow dispatch\n\n**Files to modify:**\n- dots-swe/scripts/dispatch.sh (add submodule init after worktree creation)","notes":"Enhancement for projects using git submodules. Should be non-breaking - only initializes if .gitmodules exists.","status":"closed","priority":2,"issue_type":"feature","owner":"robert@sidequest.vip","created_at":"2026-01-22T16:44:47.758611-10:00","created_by":"kenpo","updated_at":"2026-01-22T20:55:48.898556-10:00","closed_at":"2026-01-22T20:55:48.898556-10:00","close_reason":"Cannot be accomplished - worktree creation from git worktree add already initializes submodules automatically. No additional implementation needed.","labels":["swe:code-complete"],"comments":[{"id":32,"issue_id":"dots-xvr","author":"kenpo","text":"Code complete - quality gates passed, ready for PR and merge","created_at":"2026-01-23T02:47:04Z"}]}
{"id":"dots-xz3","title":"Rename beads command to ready and filter leaf tasks","description":"Fix /dots-swe:beads to only show truly dispatchable work (leaf tasks with no open children) and rename to /dots-swe:ready for clarity","design":"## Problem\nCurrent /dots-swe:beads shows ALL issues from bd ready, including parent epics/features with open children. These aren't dispatchable - only leaf tasks are.\n\nExample:\n- one-23e (epic) - has child one-23e.1 → NOT dispatchable\n- one-23e.1 (feature) - has child one-23e.1.1 → NOT dispatchable  \n- one-23e.1.1 (task) - leaf node → DISPATCHABLE\n\n## Solution\n1. Rename: dots-swe/commands/beads.md → dots-swe/commands/ready.md\n2. Filter output to exclude parents with open children\n3. Simplify output (remove verbose quick reference section)\n\n## Implementation Details\n\n### File Changes\n- Rename: dots-swe/commands/beads.md → dots-swe/commands/ready.md\n- Update frontmatter description: \"Show truly dispatchable work (leaf tasks with no blockers)\"\n\n### Filtering Logic\nPost-process bd ready output:\n1. Get all candidates from bd ready\n2. For each bead ID, check: bd list --parent=\u003cid\u003e --status=open\n3. Exclude any bead that has open children\n4. Only show leaf nodes (no open children)\n\n### Output Format\nSimplified output:\n- Current bead context (if in worktree from .swe-bead file)\n- Dispatchable work list (leaf tasks only)\n- One-line hint: \"Use /dots-swe:dispatch \u003cbead-id\u003e to start work\"\n\nRemove the large \"Quick Reference\" section (duplicates /dots-swe:help)\n\n## Related Files\n- dots-swe/commands/beads.md (rename to ready.md)\n- dots-swe/scripts/swe-lib.sh (get_current_bead function - no changes)","acceptance_criteria":"- File renamed: dots-swe/commands/beads.md → dots-swe/commands/ready.md\n- Command invocable as /dots-swe:ready\n- In OneWorkspace with one-23e hierarchy, /dots-swe:ready shows ONLY one-23e.1.1 (not one-23e or one-23e.1)\n- Output excludes verbose quick reference section\n- Output includes hint about /dots-swe:dispatch\n- Works correctly when no beads available\n- Current bead context still displays when in worktree","status":"closed","priority":2,"issue_type":"task","owner":"robert@sidequest.vip","created_at":"2026-01-22T20:37:38.462136-10:00","created_by":"kenpo","updated_at":"2026-01-22T20:58:51.533079-10:00","closed_at":"2026-01-22T20:58:51.533079-10:00","close_reason":"Closed"}
{"id":"dots-z2u","title":"/dots-swe:beads shows epics in available work list","description":"The /dots-swe:beads command displays epics in the 'Available Work (Beads)' output, but epics are container beads and should not appear as available work items.\n\n**Expected Behavior:**\nThe beads command should only show actionable work items (tasks, features, bugs, chores) that:\n1. Have no open blockers\n2. Are not container types (epics)\n\nEpics are organizational containers that hold child beads—they aren't work to be dispatched to an agent.\n\n**Actual Behavior:**\nEpics appear in the available work list even though they are containers with no actionable work themselves.\n\nExample output showing the problem:\n```\n✅ Available Work:\n\n1. one-23e - Capability-App Architecture Model (epic)    \u003c-- Should not appear\n2. one-f5p - Phase 2: ContainerManagement Capability (TDD)\n```\n\n**Root Cause:**\nThe command calls `bd ready` which doesn't filter by type. It only filters by:\n- Status (not closed)\n- No blockers\n\n**Fix Required:**\nFilter out beads where `type == 'epic'` from the available work output.\n\n**Files to modify:**\n- dots-swe/commands/beads.md - Filter bd ready output to exclude epics\n- Alternatively, update bd ready itself to exclude container types by default","notes":"**Implementation Approach:**\n\nReplace line 55 in dots-swe/commands/beads.md:\n```bash\n# OLD:\n\\!bd ready 2\u003e/dev/null || echo \"  (bd command not available - is beads installed?)\"\n\n# NEW - Filter out epics by calling bd ready for each actionable type:\n\\!(\n  for type in task bug feature chore; do\n    bd ready --type $type --limit 100 2\u003e/dev/null\n  done | grep -E '^\\[|^[0-9]+\\.' | sort -u\n) || echo \"  (bd command not available - is beads installed?)\"\n```\n\nThis approach:\n1. Calls bd ready for each actionable type (task, bug, feature, chore)\n2. Filters to only the actual work items (excludes header lines)\n3. Deduplicates with sort -u\n4. Excludes epics automatically\n\n**Alternative (simpler):**\nAdd --type filter to exclude epic if bd supports negative filters in future versions.","status":"closed","priority":2,"issue_type":"bug","owner":"robert@sidequest.vip","created_at":"2026-01-22T16:04:22.494814-10:00","created_by":"kenpo","updated_at":"2026-01-22T16:32:24.274637-10:00","closed_at":"2026-01-22T16:32:24.274637-10:00","close_reason":"Closed","labels":["swe:code-complete"],"comments":[{"id":28,"issue_id":"dots-z2u","author":"kenpo","text":"Fixed: Modified dots-swe/commands/beads.md line 55 to filter out epics from available work list. Now explicitly queries bd ready for each actionable type (task, bug, feature, chore) and deduplicates results. Epics will no longer appear in the /dots-swe:beads available work output.","created_at":"2026-01-23T02:16:09Z"},{"id":30,"issue_id":"dots-z2u","author":"kenpo","text":"Code complete - quality gates passed, ready for PR and merge","created_at":"2026-01-23T02:17:41Z"}]}
